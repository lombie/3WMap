dc=(function(){'use strict';var dc={version:"2.0.0-dev",constants:{CHART_CLASS:"dc-chart",DEBUG_GROUP_CLASS:"debug",STACK_CLASS:"stack",DESELECTED_CLASS:"deselected",SELECTED_CLASS:"selected",NODE_INDEX_NAME:"__index__",GROUP_INDEX_NAME:"__group_index__",DEFAULT_CHART_GROUP:"__default_chart_group__",EVENT_DELAY:40,NEGLIGIBLE_NUMBER:1e-10},_renderlet:null};dc.chartRegistry=function(){var _chartMap={};function initializeChartGroup(group){if(!group)group=dc.constants.DEFAULT_CHART_GROUP;if(!_chartMap[group])_chartMap[group]=[];return group;}return{has:function(chart){for(var e in _chartMap){if(_chartMap[e].indexOf(chart)>=0)return true;}return false;},register:function(chart,group){group=initializeChartGroup(group);_chartMap[group].push(chart);},clear:function(group){if(group){delete _chartMap[group];}else{_chartMap={};}},list:function(group){group=initializeChartGroup(group);return _chartMap[group];}};}();dc.registerChart=function(chart,group){dc.chartRegistry.register(chart,group);};dc.hasChart=function(chart){return dc.chartRegistry.has(chart);};dc.deregisterAllCharts=function(group){dc.chartRegistry.clear(group);};dc.filterAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){charts[i].filterAll();}};dc.renderAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){charts[i].render();}if(dc._renderlet!==null)dc._renderlet(group);};dc.redrawAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){charts[i].redraw();}if(dc._renderlet!==null)dc._renderlet(group);};dc.disableTransitions=false;dc.transition=function(selections,duration,callback){if(duration<=0||duration===undefined||dc.disableTransitions)return selections;var s=selections.transition().duration(duration);if(typeof(callback)==='function'){callback(s);}return s;};dc.units={};dc.units.integers=function(s,e){return Math.abs(e-s);};dc.units.ordinal=function(s,e,domain){return domain;};dc.units.fp={};dc.units.fp.precision=function(precision){var _f=function(s,e){var d=Math.abs((e-s)/_f.resolution);if(dc.utils.isNegligible(d-Math.floor(d)))return Math.floor(d);else
return Math.ceil(d);};_f.resolution=precision;return _f;};dc.round={};dc.round.floor=function(n){return Math.floor(n);};dc.round.ceil=function(n){return Math.ceil(n);};dc.round.round=function(n){return Math.round(n);};dc.override=function(obj,functionName,newFunction){var existingFunction=obj[functionName];obj["_"+functionName]=existingFunction;obj[functionName]=newFunction;};dc.renderlet=function(_){if(!arguments.length)return dc._renderlet;dc._renderlet=_;return dc;};dc.instanceOfChart=function(o){return o instanceof Object&&o.__dc_flag__&&true;};dc.errors={};dc.errors.Exception=function(msg){var _msg=msg||"Unexpected internal error";this.message=_msg;this.toString=function(){return _msg;};};dc.errors.InvalidStateException=function(){dc.errors.Exception.apply(this,arguments);};dc.dateFormat=d3.time.format("%m/%d/%Y");dc.printers={};dc.printers.filters=function(filters){var s="";for(var i=0;i<filters.length;++i){if(i>0)s+=", ";s+=dc.printers.filter(filters[i]);}return s;};dc.printers.filter=function(filter){var s="";if(filter){if(filter instanceof Array){if(filter.length>=2)s="["+dc.utils.printSingleValue(filter[0])+" -> "+dc.utils.printSingleValue(filter[1])+"]";else if(filter.length>=1)s=dc.utils.printSingleValue(filter[0]);}else{s=dc.utils.printSingleValue(filter);}}return s;};dc.pluck=function(n,f){return function(d,i){return f?f.call(this,d[n],i):d[n];};};dc.utils={};dc.utils.printSingleValue=function(filter){var s=""+filter;if(filter instanceof Date)s=dc.dateFormat(filter);else if(typeof(filter)=="string")s=filter;else if(dc.utils.isFloat(filter))s=dc.utils.printSingleValue.fformat(filter);else if(dc.utils.isInteger(filter))s=Math.round(filter);return s;};dc.utils.printSingleValue.fformat=d3.format(".2f");dc.utils.add=function(l,r){if(typeof r==="string")r=r.replace("%","");if(l instanceof Date){if(typeof r==="string")r=+r;var d=new Date();d.setTime(l.getTime());d.setDate(l.getDate()+r);return d;}else if(typeof r==="string"){var percentage=(+r/100);return l>0?l*(1+percentage):l*(1-percentage);}else{return l+r;}};dc.utils.subtract=function(l,r){if(typeof r==="string")r=r.replace("%","");if(l instanceof Date){if(typeof r==="string")r=+r;var d=new Date();d.setTime(l.getTime());d.setDate(l.getDate()-r);return d;}else if(typeof r==="string"){var percentage=(+r/100);return l<0?l*(1+percentage):l*(1-percentage);}else{return l-r;}};dc.utils.GroupStack=function(){var _dataLayers=[[]];var _groups=[];var _defaultAccessor;var _hideChartGroup;function initializeDataLayer(i){if(!_dataLayers[i])_dataLayers[i]=[];}this.setDataPoint=function(layerIndex,pointIndex,data){initializeDataLayer(layerIndex);_dataLayers[layerIndex][pointIndex]=data;};this.getDataPoint=function(x,y){initializeDataLayer(x);var dataPoint=_dataLayers[x][y];if(dataPoint===undefined)dataPoint=0;return dataPoint;};this.addGroup=function(group,accessor){if(!accessor)accessor=_defaultAccessor;_groups.push([group,accessor]);return _groups.length-1;};this.addNamedGroup=function(group,name,accessor){var groupIndex=this.addGroup(group,accessor);_groups[groupIndex].name=name;return name;};this.getGroupByIndex=function(index){return _groups[index][0];};this.getAccessorByIndex=function(index){return _groups[index][1];};this.getNameByIndex=function(index){return _groups[index].name;};this.size=function(){return _groups.length;};this.clear=function(){_dataLayers=[];_groups=[];};this.setDefaultAccessor=function(retriever){_defaultAccessor=retriever;};this.getDataLayers=function(){return _dataLayers;};this.clearDataLayers=function(){_dataLayers=[[]];};this.showGroups=function(name,showChartGroup){if(showChartGroup)_hideChartGroup=false;this.toggleGroups(name,false);};this.hideGroups=function(name,hideChartGroup){if(hideChartGroup)_hideChartGroup=true;this.toggleGroups(name,true);};this.toggleGroups=function(name,value){for(var i=0;i<_groups.length;++i){if(_groups[i].name===name)_groups[i].hidden=value;}};this.setTitle=function(name,titleAccessor){for(var i=0;i<_groups.length;++i){if(_groups[i].name===name)_groups[i].title=titleAccessor;}};this.getTitle=function(name){for(var i=0;i<_groups.length;++i){if(_groups[i].name===name)return _groups[i].title;}};this.toLayers=function(){var layers=[];for(var i=0;i<_dataLayers.length;++i){if(i===0&&_hideChartGroup)continue;if(i>0&&_groups[i-1].hidden)continue;var layer={index:i,points:[]};var dataPoints=_dataLayers[i];for(var j=0;j<dataPoints.length;++j)layer.points.push(dataPoints[j]);layers.push(layer);}return layers;};};dc.utils.isNumber=function(n){return n===+n;};dc.utils.isFloat=function(n){return n===+n&&n!==(n|0);};dc.utils.isInteger=function(n){return n===+n&&n===(n|0);};dc.utils.isNegligible=function(max){return max===undefined||(max<dc.constants.NEGLIGIBLE_NUMBER&&max>-dc.constants.NEGLIGIBLE_NUMBER);};var _idCounter=0;dc.utils.uniqueId=function(){return++_idCounter;};dc.utils.groupMax=function(group,accessor){var max=d3.max(group.all(),accessor);if(dc.utils.isNegligible(max))max=0;return max;};dc.utils.groupMin=function(group,accessor){var min=d3.min(group.all(),accessor);if(dc.utils.isNegligible(min))min=0;return min;};dc.utils.nameToId=function(name){return name.toLowerCase().replace(/[\s]/g,"_").replace(/[\.']/g,"");};dc.utils.appendOrSelect=function(parent,name){var element=parent.select(name);if(element.empty())element=parent.append(name);return element;};dc.utils.createLegendable=function(chart,group,accessor,color){var legendable={name:chart._getGroupName(group,accessor),data:group};if(color)legendable.color=color;return legendable;};dc.utils.safeNumber=function(n){return dc.utils.isNumber(+n)?+n:0;};dc.events={current:null};dc.events.trigger=function(closure,delay){if(!delay){closure();return;}dc.events.current=closure;setTimeout(function(){if(closure==dc.events.current)closure();},delay);};dc.baseChart=function(_chart){_chart.__dc_flag__=dc.utils.uniqueId();var _dimension;var _group;var _anchor;var _root;var _svg;var _minWidth=200;var _default_width=function(element){var width=element&&element.getBoundingClientRect&&element.getBoundingClientRect().width;return(width&&width>_minWidth)?width:_minWidth;};var _width=_default_width;var _minHeight=200;var _default_height=function(element){var height=element&&element.getBoundingClientRect&&element.getBoundingClientRect().height;return(height&&height>_minHeight)?height:_minHeight;};var _height=_default_height;var _keyAccessor=dc.pluck('key');var _valueAccessor=dc.pluck('value');var _label=dc.pluck('key');var _ordering=dc.pluck('key');var _orderSort;var _renderLabel=false;var _title=function(d){return _chart.keyAccessor()(d)+": "+_chart.valueAccessor()(d);};var _renderTitle=false;var _transitionDuration=750;var _filterPrinter=dc.printers.filters;var _renderlets=[];var _mandatoryAttributes=['dimension','group'];var _chartGroup=dc.constants.DEFAULT_CHART_GROUP;var NULL_LISTENER=function(){};var _listeners={preRender:NULL_LISTENER,postRender:NULL_LISTENER,preRedraw:NULL_LISTENER,postRedraw:NULL_LISTENER,filtered:NULL_LISTENER,zoomed:NULL_LISTENER};var _legend;var _filters=[];var _filterHandler=function(dimension,filters){dimension.filter(null);if(filters.length===0)dimension.filter(null);else if(filters.length===1)dimension.filter(filters[0]);else
dimension.filterFunction(function(d){return filters.indexOf(d)>=0;});return filters;};var _data=function(group){return group.all();};_chart.width=function(w){if(!arguments.length)return _width(_root.node());_width=d3.functor(w||_default_width);return _chart;};_chart.height=function(h){if(!arguments.length)return _height(_root.node());_height=d3.functor(h||_default_height);return _chart;};_chart.minWidth=function(w){if(!arguments.length)return _minWidth;_minWidth=w;return _chart;};_chart.minHeight=function(w){if(!arguments.length)return _minHeight;_minHeight=w;return _chart;};_chart.dimension=function(d){if(!arguments.length)return _dimension;_dimension=d;_chart.expireCache();return _chart;};_chart.data=function(d){if(!arguments.length)return _data.call(_chart,_group);_data=d3.functor(d);_chart.expireCache();return _chart;};_chart.group=function(g,name){if(!arguments.length)return _group;_group=g;_chart.expireCache();if(typeof name==='string')_chart._setGroupName(_group,name);return _chart;};function groupName(chart,g,accessor){var c=chart.chartID(),k='__names__';if(!accessor||accessor==chart.valueAccessor())accessor="default";if(!g[k])g[k]={};if(!g[k][c])g[k][c]={a:[],n:[]};var i=g[k][c].a.indexOf(accessor);if(i==-1){i=g[k][c].a.length;g[k][c].a[i]=accessor;g[k][c].n[i]={name:''};}return g[k][c].n[i];}_chart._getGroupName=function(g,accessor){return groupName(_chart,g,accessor).name;};_chart._setGroupName=function(g,name,accessor){groupName(_chart,g,accessor).name=name;};_chart.ordering=function(o){if(!arguments.length)return _ordering;_ordering=o;_orderSort=crossfilter.quicksort.by(_ordering);_chart.expireCache();return _chart;};_chart.computeOrderedGroups=function(data){if(data.length<=1)return data;if(!_orderSort)_orderSort=crossfilter.quicksort.by(_ordering);return _orderSort(data,0,data.length);};_chart.filterAll=function(){return _chart.filter(null);};_chart.dataSet=function(){return _dimension!==undefined&&_group!==undefined;};_chart.select=function(s){return _root.select(s);};_chart.selectAll=function(s){return _root?_root.selectAll(s):null;};_chart.anchor=function(a,chartGroup){if(!arguments.length)return _anchor;if(dc.instanceOfChart(a)){_anchor=a.anchor();_root=a.root();}else{_anchor=a;_root=d3.select(_anchor);_root.classed(dc.constants.CHART_CLASS,true);dc.registerChart(_chart,chartGroup);}_chartGroup=chartGroup;return _chart;};_chart.anchorName=function(){var a=_chart.anchor();if(a&&a.id)return a.id;if(a&&a.replace)return a.replace('#','');return""+_chart.chartID();};_chart.root=function(r){if(!arguments.length)return _root;_root=r;return _chart;};_chart.svg=function(_){if(!arguments.length)return _svg;_svg=_;return _chart;};_chart.resetSvg=function(){_chart.select("svg").remove();return generateSvg();};function generateSvg(){_svg=_chart.root().append("svg").attr("width",_chart.width()).attr("height",_chart.height());return _svg;}_chart.filterPrinter=function(_){if(!arguments.length)return _filterPrinter;_filterPrinter=_;return _chart;};_chart.turnOnControls=function(){if(_root){_chart.selectAll(".reset").style("display",null);_chart.selectAll(".filter").text(_filterPrinter(_chart.filters())).style("display",null);}return _chart;};_chart.turnOffControls=function(){if(_root){_chart.selectAll(".reset").style("display","none");_chart.selectAll(".filter").style("display","none").text(_chart.filter());}return _chart;};_chart.transitionDuration=function(d){if(!arguments.length)return _transitionDuration;_transitionDuration=d;return _chart;};_chart._mandatoryAttributes=function(_){if(!arguments.length)return _mandatoryAttributes;_mandatoryAttributes=_;return _chart;};function checkForMandatoryAttributes(a){if(!_chart[a]||!_chart[a]())throw new dc.errors.InvalidStateException("Mandatory attribute chart."+a+" is missing on chart[#"+_chart.anchorName()+"]");}_chart.render=function(){_listeners.preRender(_chart);if(_mandatoryAttributes)_mandatoryAttributes.forEach(checkForMandatoryAttributes);var result=_chart.doRender();if(_legend)_legend.render();_chart.activateRenderlets("postRender");return result;};_chart.activateRenderlets=function(event){if(_chart.transitionDuration()>0&&_svg){_svg.transition().duration(_chart.transitionDuration()).each("end",function(){runAllRenderlets();if(event)_listeners[event](_chart);});}else{runAllRenderlets();if(event)_listeners[event](_chart);}};_chart.redraw=function(){_listeners.preRedraw(_chart);var result=_chart.doRedraw();_chart.activateRenderlets("postRedraw");return result;};_chart._invokeFilteredListener=function(f){if(f!==undefined)_listeners.filtered(_chart,f);};_chart._invokeZoomedListener=function(){_listeners.zoomed(_chart);};_chart.hasFilter=function(filter){if(!arguments.length)return _filters.length>0;return _filters.indexOf(filter)>=0;};function removeFilter(_){_filters.splice(_filters.indexOf(_),1);applyFilters();_chart._invokeFilteredListener(_);}function addFilter(_){_filters.push(_);applyFilters();_chart._invokeFilteredListener(_);}function resetFilters(){_filters=[];applyFilters();_chart._invokeFilteredListener(null);}function applyFilters(){if(_chart.dimension()&&_chart.dimension().filter){var fs=_filterHandler(_chart.dimension(),_filters);_filters=fs?fs:_filters;}}_chart.filter=function(_){if(!arguments.length)return _filters.length>0?_filters[0]:null;if(_ instanceof Array&&_[0]instanceof Array){_[0].forEach(function(d){if(_chart.hasFilter(d)){_filters.splice(_filters.indexOf(d),1);}else{_filters.push(d);}});applyFilters();_chart._invokeFilteredListener(_);}else if(_===null){resetFilters();}else{if(_chart.hasFilter(_))removeFilter(_);else
addFilter(_);}if(_root!==null&&_chart.hasFilter()){_chart.turnOnControls();}else{_chart.turnOffControls();}return _chart;};_chart.filters=function(){return _filters;};_chart.highlightSelected=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,true);d3.select(e).classed(dc.constants.DESELECTED_CLASS,false);};_chart.fadeDeselected=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,false);d3.select(e).classed(dc.constants.DESELECTED_CLASS,true);};_chart.resetHighlight=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,false);d3.select(e).classed(dc.constants.DESELECTED_CLASS,false);};_chart.onClick=function(d){var filter=_chart.keyAccessor()(d);dc.events.trigger(function(){_chart.filter(filter);dc.redrawAll(_chart.chartGroup());});};_chart.filterHandler=function(_){if(!arguments.length)return _filterHandler;_filterHandler=_;return _chart;};_chart.doRender=function(){return _chart;};_chart.doRedraw=function(){return _chart;};_chart.legendables=function(){return[];};_chart.legendHighlight=function(d){};_chart.legendReset=function(d){};_chart.keyAccessor=function(_){if(!arguments.length)return _keyAccessor;_keyAccessor=_;return _chart;};_chart.valueAccessor=function(_){if(!arguments.length)return _valueAccessor;_valueAccessor=_;return _chart;};_chart.label=function(_){if(!arguments.length)return _label;_label=_;_renderLabel=true;return _chart;};_chart.renderLabel=function(_){if(!arguments.length)return _renderLabel;_renderLabel=_;return _chart;};_chart.title=function(_){if(!arguments.length)return _title;_title=_;_renderTitle=true;return _chart;};_chart.renderTitle=function(_){if(!arguments.length)return _renderTitle;_renderTitle=_;return _chart;};_chart.renderlet=function(_){_renderlets.push(_);return _chart;};function runAllRenderlets(){for(var i=0;i<_renderlets.length;++i){_renderlets[i](_chart);}}_chart.chartGroup=function(_){if(!arguments.length)return _chartGroup;_chartGroup=_;return _chart;};_chart.expireCache=function(){return _chart;};_chart.legend=function(l){if(!arguments.length)return _legend;_legend=l;_legend.parent(_chart);return _chart;};_chart.on=function(event,listener){_listeners[event]=listener;return _chart;};_chart.chartID=function(){return _chart.__dc_flag__;};return _chart;};dc.marginable=function(_chart){var _margin={top:10,right:50,bottom:30,left:30};_chart.margins=function(m){if(!arguments.length)return _margin;_margin=m;return _chart;};_chart.effectiveWidth=function(){return _chart.width()-_chart.margins().left-_chart.margins().right;};_chart.effectiveHeight=function(){return _chart.height()-_chart.margins().top-_chart.margins().bottom;};return _chart;};dc.coordinateGridChart=function(_chart){var GRID_LINE_CLASS="grid-line";var HORIZONTAL_CLASS="horizontal";var VERTICAL_CLASS="vertical";var Y_AXIS_LABEL_CLASS='y-axis-label';var X_AXIS_LABEL_CLASS='x-axis-label';var DEFAULT_AXIS_LABLEL_PADDING=12;_chart=dc.colorChart(dc.marginable(dc.baseChart(_chart)));_chart.colors(d3.scale.category10());_chart._mandatoryAttributes().push('x');var _parent;var _g;var _chartBodyG;var _x;var _xOriginalDomain;var _xAxis=d3.svg.axis();var _xUnits=dc.units.integers;var _xAxisPadding=0;var _xElasticity=false;var _xAxisLabel;var _xAxisLabelPadding=0;var _y;var _yAxis=d3.svg.axis();var _yAxisPadding=0;var _yElasticity=false;var _yAxisLabel;var _yAxisLabelPadding=0;var _brush=d3.svg.brush();var _brushOn=true;var _round;var _renderHorizontalGridLine=false;var _renderVerticalGridLine=false;var _refocused=false;var _unitCount;var _zoomScale=[-10,100];var _zoomOutRestrict=true;var _rangeChart;var _focusChart;var _mouseZoomable=false;var _clipPadding=0;var _outerRangeBandPadding=0.5;var _rangeBandPadding=0;_chart.rescale=function(){_unitCount=undefined;};_chart.rangeChart=function(_){if(!arguments.length)return _rangeChart;_rangeChart=_;_rangeChart.focusChart(_chart);return _chart;};_chart.zoomScale=function(_){if(!arguments.length)return _zoomScale;_zoomScale=_;return _chart;};_chart.zoomOutRestrict=function(_){if(!arguments.length)return _zoomOutRestrict;_zoomOutRestrict=_;return _chart;};_chart._generateG=function(parent){if(parent===undefined)_parent=_chart.svg();else
_parent=parent;_g=_parent.append("g");_chartBodyG=_g.append("g").attr("class","chart-body").attr("transform","translate("+_chart.margins().left+", "+_chart.margins().top+")").attr("clip-path","url(#"+getClipPathId()+")");return _g;};_chart.g=function(_){if(!arguments.length)return _g;_g=_;return _chart;};_chart.mouseZoomable=function(z){if(!arguments.length)return _mouseZoomable;_mouseZoomable=z;return _chart;};_chart.chartBodyG=function(_){if(!arguments.length)return _chartBodyG;_chartBodyG=_;return _chart;};_chart.x=function(_){if(!arguments.length)return _x;_x=_;_xOriginalDomain=_x.domain();return _chart;};_chart.xOriginalDomain=function(){return _xOriginalDomain;};_chart.xUnits=function(_){if(!arguments.length)return _xUnits;_xUnits=_;return _chart;};_chart.xAxis=function(_){if(!arguments.length)return _xAxis;_xAxis=_;return _chart;};_chart.elasticX=function(_){if(!arguments.length)return _xElasticity;_xElasticity=_;return _chart;};_chart.xAxisPadding=function(_){if(!arguments.length)return _xAxisPadding;_xAxisPadding=_;return _chart;};_chart.xUnitCount=function(){if(_unitCount===undefined){var units=_chart.xUnits()(_chart.x().domain()[0],_chart.x().domain()[1],_chart.x().domain());if(units instanceof Array)_unitCount=units.length;else
_unitCount=units;}return _unitCount;};_chart.isOrdinal=function(){return _chart.xUnits()===dc.units.ordinal;};function prepareXAxis(g){if(_chart.elasticX()&&!_chart.isOrdinal()){_x.domain([_chart.xAxisMin(),_chart.xAxisMax()]);}else if(_chart.isOrdinal()&&_x.domain().length===0){var orderedData=_chart.computeOrderedGroups(_chart.data());_x.domain(orderedData.map(_chart.keyAccessor()));}if(_chart.isOrdinal()){_x.rangeBands([0,_chart.xAxisLength()],_rangeBandPadding,_outerRangeBandPadding);}else{_x.range([0,_chart.xAxisLength()]);}_xAxis=_xAxis.scale(_chart.x()).orient("bottom");renderVerticalGridLines(g);}_chart.renderXAxis=function(g){var axisXG=g.selectAll("g.x");if(axisXG.empty())axisXG=g.append("g").attr("class","axis x").attr("transform","translate("+_chart.margins().left+","+_chart.xAxisY()+")");var axisXLab=g.selectAll("text."+X_AXIS_LABEL_CLASS);if(axisXLab.empty()&&_chart.xAxisLabel())axisXLab=g.append('text').attr("transform","translate("+(_chart.margins().left+_chart.xAxisLength()/2)+","+(_chart.height()-_xAxisLabelPadding)+")").attr('class',X_AXIS_LABEL_CLASS).attr('text-anchor','middle').text(_chart.xAxisLabel());if(_chart.xAxisLabel()&&axisXLab.text()!=_chart.xAxisLabel())axisYLab.text(_chart.xAxisLabel());dc.transition(axisXG,_chart.transitionDuration()).call(_xAxis);};function renderVerticalGridLines(g){var gridLineG=g.selectAll("g."+VERTICAL_CLASS);if(_renderVerticalGridLine){if(gridLineG.empty())gridLineG=g.insert("g",":first-child").attr("class",GRID_LINE_CLASS+" "+VERTICAL_CLASS).attr("transform","translate("+_chart.yAxisX()+","+_chart.margins().top+")");var ticks=_xAxis.tickValues()?_xAxis.tickValues():_x.ticks(_xAxis.ticks()[0]);var lines=gridLineG.selectAll("line").data(ticks);var linesGEnter=lines.enter().append("line").attr("x1",function(d){return _x(d);}).attr("y1",_chart.xAxisY()-_chart.margins().top).attr("x2",function(d){return _x(d);}).attr("y2",0).attr("opacity",0);dc.transition(linesGEnter,_chart.transitionDuration()).attr("opacity",1);dc.transition(lines,_chart.transitionDuration()).attr("x1",function(d){return _x(d);}).attr("y1",_chart.xAxisY()-_chart.margins().top).attr("x2",function(d){return _x(d);}).attr("y2",0);lines.exit().remove();}else{gridLineG.selectAll("line").remove();}}_chart.xAxisY=function(){return(_chart.height()-_chart.margins().bottom);};_chart.xAxisLength=function(){return _chart.effectiveWidth();};_chart.xAxisLabel=function(_,pad){if(!arguments.length)return _xAxisLabel;_xAxisLabel=_;_chart.margins().bottom-=_xAxisLabelPadding;_xAxisLabelPadding=(pad===undefined)?DEFAULT_AXIS_LABLEL_PADDING:pad;_chart.margins().bottom+=_xAxisLabelPadding;return _chart;};function prepareYAxis(g){if(_y===undefined||_chart.elasticY()){_y=d3.scale.linear();_y.domain([_chart.yAxisMin(),_chart.yAxisMax()]).rangeRound([_chart.yAxisHeight(),0]);}_y.range([_chart.yAxisHeight(),0]);_yAxis=_yAxis.scale(_y).orient("left");renderHorizontalGridLines(g);}_chart.renderYAxis=function(g){var axisYG=g.selectAll("g.y");if(axisYG.empty())axisYG=g.append("g").attr("class","axis y").attr("transform","translate("+_chart.yAxisX()+","+_chart.margins().top+")");var axisYLab=g.selectAll("text."+Y_AXIS_LABEL_CLASS);if(axisYLab.empty()&&_chart.yAxisLabel())axisYLab=g.append('text').attr("transform","translate("+_yAxisLabelPadding+","+(_chart.margins().top+_chart.yAxisHeight()/2)+"),rotate(-90)").attr('class',Y_AXIS_LABEL_CLASS).attr('text-anchor','middle').text(_chart.yAxisLabel());if(_chart.yAxisLabel()&&axisYLab.text()!=_chart.yAxisLabel())axisYLab.text(_chart.yAxisLabel());dc.transition(axisYG,_chart.transitionDuration()).call(_yAxis);};function renderHorizontalGridLines(g){var gridLineG=g.selectAll("g."+HORIZONTAL_CLASS);if(_renderHorizontalGridLine){var ticks=_yAxis.tickValues()?_yAxis.tickValues():_y.ticks(_yAxis.ticks()[0]);if(gridLineG.empty())gridLineG=g.insert("g",":first-child").attr("class",GRID_LINE_CLASS+" "+HORIZONTAL_CLASS).attr("transform","translate("+_chart.yAxisX()+","+_chart.margins().top+")");var lines=gridLineG.selectAll("line").data(ticks);var linesGEnter=lines.enter().append("line").attr("x1",1).attr("y1",function(d){return _y(d);}).attr("x2",_chart.xAxisLength()).attr("y2",function(d){return _y(d);}).attr("opacity",0);dc.transition(linesGEnter,_chart.transitionDuration()).attr("opacity",1);dc.transition(lines,_chart.transitionDuration()).attr("x1",1).attr("y1",function(d){return _y(d);}).attr("x2",_chart.xAxisLength()).attr("y2",function(d){return _y(d);});lines.exit().remove();}else{gridLineG.selectAll("line").remove();}}_chart.yAxisX=function(){return _chart.margins().left;};_chart.yAxisLabel=function(_,pad){if(!arguments.length)return _yAxisLabel;_yAxisLabel=_;_chart.margins().left-=_yAxisLabelPadding;_yAxisLabelPadding=(pad===undefined)?DEFAULT_AXIS_LABLEL_PADDING:pad;_chart.margins().left+=_yAxisLabelPadding;return _chart;};_chart.y=function(_){if(!arguments.length)return _y;_y=_;return _chart;};_chart.yAxis=function(y){if(!arguments.length)return _yAxis;_yAxis=y;return _chart;};_chart.elasticY=function(_){if(!arguments.length)return _yElasticity;_yElasticity=_;return _chart;};_chart.renderHorizontalGridLines=function(_){if(!arguments.length)return _renderHorizontalGridLine;_renderHorizontalGridLine=_;return _chart;};_chart.renderVerticalGridLines=function(_){if(!arguments.length)return _renderVerticalGridLine;_renderVerticalGridLine=_;return _chart;};_chart.xAxisMin=function(){var min=d3.min(_chart.data(),function(e){return _chart.keyAccessor()(e);});return dc.utils.subtract(min,_xAxisPadding);};_chart.xAxisMax=function(){var max=d3.max(_chart.data(),function(e){return _chart.keyAccessor()(e);});return dc.utils.add(max,_xAxisPadding);};_chart.yAxisMin=function(){var min=d3.min(_chart.data(),function(e){return _chart.valueAccessor()(e);});return dc.utils.subtract(min,_yAxisPadding);};_chart.yAxisMax=function(){var max=d3.max(_chart.data(),function(e){return _chart.valueAccessor()(e);});return dc.utils.add(max,_yAxisPadding);};_chart.yAxisPadding=function(_){if(!arguments.length)return _yAxisPadding;_yAxisPadding=_;return _chart;};_chart.yAxisHeight=function(){return _chart.effectiveHeight();};_chart.round=function(_){if(!arguments.length)return _round;_round=_;return _chart;};_chart._rangeBandPadding=function(_){if(!arguments.length)return _rangeBandPadding;_rangeBandPadding=_;return _chart;};_chart._outerRangeBandPadding=function(_){if(!arguments.length)return _outerRangeBandPadding;_outerRangeBandPadding=_;return _chart;};dc.override(_chart,"filter",function(_){if(!arguments.length)return _chart._filter();_chart._filter(_);if(_){_chart.brush().extent(_);}else{_chart.brush().clear();}return _chart;});_chart.brush=function(_){if(!arguments.length)return _brush;_brush=_;return _chart;};function brushHeight(){return _chart.xAxisY()-_chart.margins().top;}_chart.renderBrush=function(g){if(_chart.isOrdinal())_brushOn=false;if(_brushOn){_brush.on("brush",_chart._brushing);var gBrush=g.append("g").attr("class","brush").attr("transform","translate("+_chart.margins().left+","+_chart.margins().top+")").call(_brush.x(_chart.x()));gBrush.selectAll("rect").attr("height",brushHeight());gBrush.selectAll(".resize").append("path").attr("d",_chart.resizeHandlePath);if(_chart.hasFilter()){_chart.redrawBrush(g);}}};_chart.extendBrush=function(){var extent=_brush.extent();if(_chart.round()){extent[0]=extent.map(_chart.round())[0];extent[1]=extent.map(_chart.round())[1];_g.select(".brush").call(_brush.extent(extent));}return extent;};_chart.brushIsEmpty=function(extent){return _brush.empty()||!extent||extent[1]<=extent[0];};_chart._brushing=function(){var extent=_chart.extendBrush();_chart.redrawBrush(_g);if(_chart.brushIsEmpty(extent)){dc.events.trigger(function(){_chart.filter(null);dc.redrawAll(_chart.chartGroup());});}else{dc.events.trigger(function(){_chart.filter(null);_chart.filter([extent[0],extent[1]]);dc.redrawAll(_chart.chartGroup());},dc.constants.EVENT_DELAY);}};_chart.redrawBrush=function(g){if(_brushOn){if(_chart.filter()&&_chart.brush().empty())_chart.brush().extent(_chart.filter());var gBrush=g.select("g.brush");gBrush.call(_chart.brush().x(_chart.x()));gBrush.selectAll("rect").attr("height",brushHeight());}_chart.fadeDeselectedArea();};_chart.fadeDeselectedArea=function(){};_chart.resizeHandlePath=function(d){var e=+(d=="e"),x=e?1:-1,y=brushHeight()/3;return"M"+(0.5*x)+","+y+"A6,6 0 0 "+e+" "+(6.5*x)+","+(y+6)+"V"+(2*y-6)+"A6,6 0 0 "+e+" "+(0.5*x)+","+(2*y)+"Z"+"M"+(2.5*x)+","+(y+8)+"V"+(2*y-8)+"M"+(4.5*x)+","+(y+8)+"V"+(2*y-8);};function getClipPathId(){return _chart.anchorName()+"-clip";}_chart.clipPadding=function(p){if(!arguments.length)return _clipPadding;_clipPadding=p;return _chart;};function generateClipPath(){var defs=dc.utils.appendOrSelect(_parent,"defs");var chartBodyClip=dc.utils.appendOrSelect(defs,"clipPath").attr("id",getClipPathId());var padding=_clipPadding*2;dc.utils.appendOrSelect(chartBodyClip,"rect").attr("width",_chart.xAxisLength()+padding).attr("height",_chart.yAxisHeight()+padding);}_chart._preprocessData=function(){};_chart.doRender=function(){_chart.resetSvg();_chart._preprocessData();_chart._generateG();generateClipPath();prepareXAxis(_chart.g());prepareYAxis(_chart.g());_chart.plotData();_chart.renderXAxis(_chart.g());_chart.renderYAxis(_chart.g());_chart.renderBrush(_chart.g());enableMouseZoom();return _chart;};function enableMouseZoom(){if(_mouseZoomable){_chart.root().call(d3.behavior.zoom().x(_chart.x()).scaleExtent(_zoomScale).on("zoom",function(){_chart.focus(_chart.x().domain());_chart._invokeZoomedListener();updateRangeSelChart();}));}}function updateRangeSelChart(){if(_rangeChart){var refDom=_chart.x().domain();if(_zoomOutRestrict){var origDom=_rangeChart.xOriginalDomain();var newDom=[refDom[0]<origDom[0]?refDom[0]:origDom[0],refDom[1]>origDom[1]?refDom[1]:origDom[1]];_rangeChart.focus(newDom);}else{_rangeChart.focus(refDom);}_rangeChart.filter(null);_rangeChart.filter(refDom);dc.events.trigger(function(){dc.redrawAll(_chart.chartGroup());});}}_chart.doRedraw=function(){_chart._preprocessData();prepareXAxis(_chart.g());prepareYAxis(_chart.g());_chart.plotData();if(_chart.elasticY())_chart.renderYAxis(_chart.g());if(_chart.elasticX()||_refocused)_chart.renderXAxis(_chart.g());_chart.redrawBrush(_chart.g());return _chart;};_chart.subRender=function(){_chart.plotData();return _chart;};_chart.brushOn=function(_){if(!arguments.length)return _brushOn;_brushOn=_;return _chart;};function hasRangeSelected(range){return range instanceof Array&&range.length>1;}_chart.focus=function(range){_refocused=true;if(hasRangeSelected(range)){_chart.x().domain(range);}else{_chart.x().domain(_chart.xOriginalDomain());}_chart.rescale();_chart.redraw();if(!hasRangeSelected(range))_refocused=false;};_chart.refocused=function(){return _refocused;};_chart.focusChart=function(c){if(!arguments.length)return _focusChart;_focusChart=c;_chart.on("filtered",function(chart){dc.events.trigger(function(){_focusChart.focus(chart.filter());_focusChart.filter(chart.filter());dc.redrawAll(chart.chartGroup());});});return _chart;};return _chart;};dc.colorChart=function(_chart){var _colors=d3.scale.category20c();var _colorAccessor=function(d){return _chart.keyAccessor()(d);};var _colorCalculator=function(value){return _colors(value,_chart);};_chart.colors=function(_){if(!arguments.length)return _colors;if(_ instanceof Array)_colors=d3.scale.quantize().range(_);else _colors=_;return _chart;};_chart.ordinalColors=function(r){return _chart.colors(d3.scale.ordinal().range(r));};_chart.linearColors=function(r){return _chart.colors(d3.scale.linear().range(r).interpolate(d3.interpolateHcl));};_chart.colorAccessor=function(_){if(!arguments.length)return _colorAccessor;_colorAccessor=_;return _chart;};_chart.colorDomain=function(_){if(!arguments.length)return _colors.domain();_colors.domain(_);return _chart;};_chart.calculateColorDomain=function(){var newDomain=[d3.min(_chart.data(),_chart.colorAccessor()),d3.max(_chart.data(),_chart.colorAccessor())];_colors.domain(newDomain);};_chart.getColor=function(d,i){return _colorCalculator(_colorAccessor(d,i));};_chart.colorCalculator=function(_){if(!arguments.length)return _colorCalculator;_colorCalculator=_;return _chart;};return _chart;};dc.stackableChart=function(_chart){var _groupStack=new dc.utils.GroupStack();var _stackLayout=d3.layout.stack().offset("zero").order("default").values(function(d){return d.points;});var _allGroups;var _allValueAccessors;var _allKeyAccessors;var _stackLayers;_chart.stack=function(group,name,accessor){if(!arguments.length)_groupStack.clear();_groupStack.setDefaultAccessor(_chart.valueAccessor());if(typeof name==='string'){_chart._setGroupName(group,name,accessor);_groupStack.addNamedGroup(group,name,accessor);}else{accessor=name;_groupStack.addGroup(group,accessor);}_chart.expireCache();return _chart;};_chart.hideStack=function(stackName){_groupStack.hideGroups(stackName,_chart._getGroupName(_chart.group())==stackName);};_chart.showStack=function(stackName){_groupStack.showGroups(stackName,_chart._getGroupName(_chart.group())==stackName);};_chart.expireCache=function(){_allGroups=null;_allValueAccessors=null;_allKeyAccessors=null;_stackLayers=null;return _chart;};_chart.allGroups=function(){if(_allGroups===null){_allGroups=[];_allGroups.push(_chart.group());for(var i=0;i<_groupStack.size();++i)_allGroups.push(_groupStack.getGroupByIndex(i));}return _allGroups;};_chart.allValueAccessors=function(){if(_allValueAccessors===null){_allValueAccessors=[];_allValueAccessors.push(_chart.valueAccessor());for(var i=0;i<_groupStack.size();++i)_allValueAccessors.push(_groupStack.getAccessorByIndex(i));}return _allValueAccessors;};_chart.getValueAccessorByIndex=function(groupIndex){return _chart.allValueAccessors()[groupIndex];};_chart.yAxisMin=function(){var min,all=flattenStack();min=d3.min(all,function(p){return(p.y+p.y0<p.y0)?(p.y+p.y0):p.y0;});min=dc.utils.subtract(min,_chart.yAxisPadding());return min;};_chart.yAxisMax=function(){var max,all=flattenStack();max=d3.max(all,function(p){return p.y+p.y0;});max=dc.utils.add(max,_chart.yAxisPadding());return max;};function flattenStack(){var all=[];if(_chart.x()){var xDomain=_chart.x().domain();var test;if(_chart.isOrdinal()){var domainSet=d3.set(xDomain);test=function(p){return domainSet.has(p.x);};}else{test=function(p){return p.x>=xDomain[0]&&p.x<=xDomain[xDomain.length-1];};}_chart.stackLayers().forEach(function(e){e.points.forEach(function(p){if(test(p))all.push(p);});});}else{_chart.stackLayers().forEach(function(e){all=all.concat(e.points);});}return all;}_chart.allKeyAccessors=function(){if(_allKeyAccessors===null){_allKeyAccessors=[];_allKeyAccessors.push(_chart.keyAccessor());for(var i=0;i<_groupStack.size();++i)_allKeyAccessors.push(_chart.keyAccessor());}return _allKeyAccessors;};_chart.getKeyAccessorByIndex=function(groupIndex){return _chart.allKeyAccessors()[groupIndex];};_chart.xAxisMin=function(){var min=_chart.allGroups().reduce(function(min,group,groupIndex){var m=dc.utils.groupMin(group,_chart.getKeyAccessorByIndex(groupIndex));return(min===null||min>m)?m:min;},null);return dc.utils.subtract(min,_chart.xAxisPadding());};_chart.xAxisMax=function(){var max=_chart.allGroups().reduce(function(max,group,groupIndex){var m=dc.utils.groupMax(group,_chart.getKeyAccessorByIndex(groupIndex));return(max===null||max<m)?m:max;},null);return dc.utils.add(max,_chart.xAxisPadding());};function calculateDataPointMatrix(group,groupIndex){group.all().forEach(function(d,dataIndex){var key=_chart.getKeyAccessorByIndex(groupIndex)(d);var value=_chart.getValueAccessorByIndex(groupIndex)(d);_groupStack.setDataPoint(groupIndex,dataIndex,{data:d,x:key,y:value,layer:groupIndex});});}_chart.calculateDataPointMatrixForAll=function(){_groupStack.clearDataLayers();_chart.allGroups().forEach(calculateDataPointMatrix);};_chart.getChartStack=function(){return _groupStack;};dc.override(_chart,"valueAccessor",function(_){if(!arguments.length)return _chart._valueAccessor();_chart.expireCache();return _chart._valueAccessor(_);});dc.override(_chart,"keyAccessor",function(_){if(!arguments.length)return _chart._keyAccessor();_chart.expireCache();return _chart._keyAccessor(_);});dc.override(_chart,"title",function(stackName,titleAccessor){if(!stackName)return _chart._title();var firstStack=_chart.group()&&stackName===_chart._getGroupName(_chart.group());if(typeof stackName==='function'){return _chart._title(stackName);}else if(!titleAccessor){if(firstStack)return _chart._title();else
return _groupStack.getTitle(stackName);}if(firstStack)return _chart._title(titleAccessor);else
_groupStack.setTitle(stackName,titleAccessor);return _chart;});_chart.getTitleByIndex=function(index){if(index===0){return _chart.title();}else{var stackTitle=_chart.title(_groupStack.getNameByIndex(index-1));return stackTitle||_chart.title();}};_chart.stackLayout=function(stack){if(!arguments.length)return _stackLayout;_stackLayout=stack;return _chart;};_chart.stackLayers=function(_){if(!arguments.length){if(_stackLayers===null){_chart.calculateDataPointMatrixForAll();_stackLayers=_chart.stackLayout()(_groupStack.toLayers());}return _stackLayers;}else{_stackLayers=_;}};_chart._layerColorAccessor=function(d){return d.layer===undefined?d.index:d.layer;};_chart.colorAccessor(_chart._layerColorAccessor);_chart.legendables=function(){return _chart.allGroups().map(function(g,i){return dc.utils.createLegendable(_chart,g,_chart.getValueAccessorByIndex(i),_chart.colorCalculator()(i));});};return _chart;};dc.abstractBubbleChart=function(_chart){var _maxBubbleRelativeSize=0.3;var _minRadiusWithLabel=10;_chart.BUBBLE_NODE_CLASS="node";_chart.BUBBLE_CLASS="bubble";_chart.MIN_RADIUS=10;_chart=dc.colorChart(_chart);_chart.renderLabel(true);_chart.renderTitle(false);_chart.data(function(group){return group.top(Infinity);});var _r=d3.scale.linear().domain([0,100]);var _rValueAccessor=function(d){return d.r;};_chart.r=function(_){if(!arguments.length)return _r;_r=_;return _chart;};_chart.radiusValueAccessor=function(_){if(!arguments.length)return _rValueAccessor;_rValueAccessor=_;return _chart;};_chart.rMin=function(){var min=d3.min(_chart.data(),function(e){return _chart.radiusValueAccessor()(e);});return min;};_chart.rMax=function(){var max=d3.max(_chart.data(),function(e){return _chart.radiusValueAccessor()(e);});return max;};_chart.bubbleR=function(d){var value=_chart.radiusValueAccessor()(d);var r=_chart.r()(value);if(isNaN(r)||value<=0)r=0;return r;};var labelFunction=function(d){return _chart.label()(d);};var labelOpacity=function(d){return(_chart.bubbleR(d)>_minRadiusWithLabel)?1:0;};_chart.doRenderLabel=function(bubbleGEnter){if(_chart.renderLabel()){var label=bubbleGEnter.select("text");if(label.empty()){label=bubbleGEnter.append("text").attr("text-anchor","middle").attr("dy",".3em").on("click",_chart.onClick);}label.attr("opacity",0).text(labelFunction);dc.transition(label,_chart.transitionDuration()).attr("opacity",labelOpacity);}};_chart.doUpdateLabels=function(bubbleGEnter){if(_chart.renderLabel()){var labels=bubbleGEnter.selectAll("text").text(labelFunction);dc.transition(labels,_chart.transitionDuration()).attr("opacity",labelOpacity);}};var titleFunction=function(d){return _chart.title()(d);};_chart.doRenderTitles=function(g){if(_chart.renderTitle()){var title=g.select("title");if(title.empty())g.append("title").text(titleFunction);}};_chart.doUpdateTitles=function(g){if(_chart.renderTitle()){g.selectAll("title").text(titleFunction);}};_chart.minRadiusWithLabel=function(_){if(!arguments.length)return _minRadiusWithLabel;_minRadiusWithLabel=_;return _chart;};_chart.maxBubbleRelativeSize=function(_){if(!arguments.length)return _maxBubbleRelativeSize;_maxBubbleRelativeSize=_;return _chart;};_chart.fadeDeselectedArea=function(){if(_chart.hasFilter()){_chart.selectAll("g."+_chart.BUBBLE_NODE_CLASS).each(function(d){if(_chart.isSelectedNode(d)){_chart.highlightSelected(this);}else{_chart.fadeDeselected(this);}});}else{_chart.selectAll("g."+_chart.BUBBLE_NODE_CLASS).each(function(d){_chart.resetHighlight(this);});}};_chart.isSelectedNode=function(d){return _chart.hasFilter(d.key);};_chart.onClick=function(d){var filter=d.key;dc.events.trigger(function(){_chart.filter(filter);dc.redrawAll(_chart.chartGroup());});};return _chart;};dc.pieChart=function(parent,chartGroup){var DEFAULT_MIN_ANGLE_FOR_LABEL=0.5;var _sliceCssClass="pie-slice";var _radius,_innerRadius=0;var _g;var _minAngleForLabel=DEFAULT_MIN_ANGLE_FOR_LABEL;var _chart=dc.capped(dc.colorChart(dc.baseChart({})));_chart.colorAccessor(_chart.cappedKeyAccessor);_chart.title(function(d){return _chart.cappedKeyAccessor(d)+": "+_chart.cappedValueAccessor(d);});_chart.slicesCap=_chart.cap;_chart.label(_chart.cappedKeyAccessor);_chart.renderLabel(true);_chart.transitionDuration(350);_chart.doRender=function(){_chart.resetSvg();_g=_chart.svg().append("g").attr("transform","translate("+_chart.cx()+","+_chart.cy()+")");drawChart();return _chart;};function drawChart(){_radius=_radius?_radius:d3.min([_chart.width(),_chart.height()])/2;var arc=buildArcs();var pie=pieLayout();var pieData=pie(_chart.data());if(_g){var slices=_g.selectAll("g."+_sliceCssClass).data(pieData);createElements(slices,arc,pieData);updateElements(pieData,arc);removeElements(slices);highlightFilter();}}function createElements(slices,arc,pieData){var slicesEnter=createSliceNodes(slices);createSlicePath(slicesEnter,arc);createTitles(slicesEnter);createLabels(pieData,arc);}function createSliceNodes(slices){var slicesEnter=slices.enter().append("g").attr("class",function(d,i){return _sliceCssClass+" _"+i;});return slicesEnter;}function createSlicePath(slicesEnter,arc){var slicePath=slicesEnter.append("path").attr("fill",fill).on("click",onClick).attr("d",function(d,i){return safeArc(d,i,arc);});slicePath.transition().duration(_chart.transitionDuration()).attrTween("d",tweenPie);}function createTitles(slicesEnter){if(_chart.renderTitle()){slicesEnter.append("title").text(function(d){return _chart.title()(d);});}}function createLabels(pieData,arc){if(_chart.renderLabel()){var labels=_g.selectAll("text."+_sliceCssClass).data(pieData);labels.exit().remove();var labelsEnter=labels.enter().append("text").attr("class",function(d,i){return _sliceCssClass+" _"+i;}).on("click",onClick);dc.transition(labelsEnter,_chart.transitionDuration()).attr("transform",function(d){d.innerRadius=_chart.innerRadius();d.outerRadius=_chart.radius();var centroid=arc.centroid(d);if(isNaN(centroid[0])||isNaN(centroid[1])){return"translate(0,0)";}else{return"translate("+centroid+")";}}).attr("text-anchor","middle").text(function(d){var data=d.data;if(sliceHasNoData(data)||sliceTooSmall(d))return"";return _chart.label()(d.data);});}}function updateElements(pieData,arc){updateSlicePaths(pieData,arc);updateLabels(pieData,arc);updateTitles(pieData);}function updateSlicePaths(pieData,arc){var slicePaths=_g.selectAll("g."+_sliceCssClass).data(pieData).select("path").attr("d",function(d,i){return safeArc(d,i,arc);});dc.transition(slicePaths,_chart.transitionDuration(),function(s){s.attrTween("d",tweenPie);}).attr("fill",fill);}function updateLabels(pieData,arc){if(_chart.renderLabel()){var labels=_g.selectAll("text."+_sliceCssClass).data(pieData);dc.transition(labels,_chart.transitionDuration()).attr("transform",function(d){d.innerRadius=_innerRadius;d.outerRadius=_radius;var centroid=arc.centroid(d);if(isNaN(centroid[0])||isNaN(centroid[1])){return"translate(0,0)";}else{return"translate("+centroid+")";}}).attr("text-anchor","middle").text(function(d){var data=d.data;if(sliceHasNoData(data)||sliceTooSmall(d))return"";return _chart.label()(d.data);});}}function updateTitles(pieData){if(_chart.renderTitle()){_g.selectAll("g."+_sliceCssClass).data(pieData).select("title").text(function(d){return _chart.title()(d.data);});}}function removeElements(slices){slices.exit().remove();}function highlightFilter(){if(_chart.hasFilter()){_chart.selectAll("g."+_sliceCssClass).each(function(d){if(isSelectedSlice(d)){_chart.highlightSelected(this);}else{_chart.fadeDeselected(this);}});}else{_chart.selectAll("g."+_sliceCssClass).each(function(d){_chart.resetHighlight(this);});}}_chart.innerRadius=function(r){if(!arguments.length)return _innerRadius;_innerRadius=r;return _chart;};_chart.radius=function(r){if(!arguments.length)return _radius;_radius=r;return _chart;};_chart.cx=function(){return _chart.width()/2;};_chart.cy=function(){return _chart.height()/2;};function buildArcs(){return d3.svg.arc().outerRadius(_radius).innerRadius(_innerRadius);}function isSelectedSlice(d){return _chart.hasFilter(_chart.cappedKeyAccessor(d.data));}_chart.doRedraw=function(){drawChart();return _chart;};_chart.minAngleForLabel=function(_){if(!arguments.length)return _minAngleForLabel;_minAngleForLabel=_;return _chart;};function pieLayout(){return d3.layout.pie().sort(null).value(_chart.cappedValueAccessor);}function sliceTooSmall(d){var angle=(d.endAngle-d.startAngle);return isNaN(angle)||angle<_minAngleForLabel;}function sliceHasNoData(d){return _chart.cappedValueAccessor(d)===0;}function tweenPie(b){b.innerRadius=_innerRadius;var current=this._current;if(isOffCanvas(current))current={startAngle:0,endAngle:0};var i=d3.interpolate(current,b);this._current=i(0);return function(t){return safeArc(i(t),0,buildArcs());};}function isOffCanvas(current){return!current||isNaN(current.startAngle)||isNaN(current.endAngle);}function fill(d,i){return _chart.getColor(d.data,i);}function onClick(d,i){_chart.onClick(d.data,i);}function safeArc(d,i,arc){var path=arc(d,i);if(path.indexOf("NaN")>=0)path="M0,0";return path;}return _chart.anchor(parent,chartGroup);};dc.barChart=function(parent,chartGroup){var MIN_BAR_WIDTH=1;var DEFAULT_GAP_BETWEEN_BARS=2;var _chart=dc.stackableChart(dc.coordinateGridChart({}));var _gap=DEFAULT_GAP_BETWEEN_BARS;var _centerBar=false;var _barWidth;dc.override(_chart,'rescale',function(){_chart._rescale();_barWidth=undefined;});_chart.plotData=function(){var layers=_chart.chartBodyG().selectAll("g.stack").data(_chart.stackLayers());calculateBarWidth();layers.enter().append("g").attr("class",function(d,i){return"stack "+"_"+i;});layers.each(function(d){var layer=d3.select(this);renderBars(layer,d);});_chart.stackLayers(null);};function barHeight(d){return dc.utils.safeNumber(Math.abs(_chart.y()(d.y+d.y0)-_chart.y()(d.y0)));}function renderBars(layer,d){var bars=layer.selectAll("rect.bar").data(d.points,dc.pluck('data',_chart.keyAccessor()));bars.enter().append("rect").attr("class","bar").attr("fill",_chart.getColor);if(_chart.renderTitle()){bars.append("title").text(dc.pluck('data',_chart.title()));}if(_chart.isOrdinal())bars.on("click",onClick);dc.transition(bars,_chart.transitionDuration()).attr("x",function(d){var x=_chart.x()(d.x);if(_centerBar)x-=_barWidth/2;if(_chart.isOrdinal())x+=_gap/2;return dc.utils.safeNumber(x);}).attr("y",function(d){var y=_chart.y()(d.y+d.y0);if(d.y<0)y-=barHeight(d);return dc.utils.safeNumber(y);}).attr("width",_barWidth).attr("height",function(d){return barHeight(d);}).select("title").text(dc.pluck('data',_chart.title()));dc.transition(bars.exit(),_chart.transitionDuration()).attr("height",0).remove();}function calculateBarWidth(){if(_barWidth===undefined){var numberOfBars=_chart.xUnitCount();if(_chart.isOrdinal()&&!_gap)_barWidth=Math.floor(_chart.x().rangeBand());else if(_gap)_barWidth=Math.floor((_chart.xAxisLength()-(numberOfBars-1)*_gap)/numberOfBars);else
_barWidth=Math.floor(_chart.xAxisLength()/(1+_chart.barPadding())/numberOfBars);if(_barWidth==Infinity||isNaN(_barWidth)||_barWidth<MIN_BAR_WIDTH)_barWidth=MIN_BAR_WIDTH;}}_chart.fadeDeselectedArea=function(){var bars=_chart.chartBodyG().selectAll("rect.bar");var extent=_chart.brush().extent();if(_chart.isOrdinal()){if(_chart.hasFilter()){bars.classed(dc.constants.SELECTED_CLASS,function(d){return _chart.hasFilter(_chart.keyAccessor()(d.data));});bars.classed(dc.constants.DESELECTED_CLASS,function(d){return!_chart.hasFilter(_chart.keyAccessor()(d.data));});}else{bars.classed(dc.constants.SELECTED_CLASS,false);bars.classed(dc.constants.DESELECTED_CLASS,false);}}else{if(!_chart.brushIsEmpty(extent)){var start=extent[0];var end=extent[1];bars.classed(dc.constants.DESELECTED_CLASS,function(d){var xValue=_chart.keyAccessor()(d.data);return xValue<start||xValue>=end;});}else{bars.classed(dc.constants.DESELECTED_CLASS,false);}}};_chart.centerBar=function(_){if(!arguments.length)return _centerBar;_centerBar=_;return _chart;};function onClick(d){_chart.onClick(d.data);}_chart.barPadding=function(_){if(!arguments.length)return _chart._rangeBandPadding();_chart._rangeBandPadding(_);_gap=0;return _chart;};_chart.outerPadding=_chart._outerRangeBandPadding;_chart.gap=function(_){if(!arguments.length)return _gap;_gap=_;return _chart;};_chart.extendBrush=function(){var extent=_chart.brush().extent();if(_chart.round()&&!_centerBar){extent[0]=extent.map(_chart.round())[0];extent[1]=extent.map(_chart.round())[1];_chart.chartBodyG().select(".brush").call(_chart.brush().extent(extent));}return extent;};_chart.legendHighlight=function(d){_chart.select('.chart-body').selectAll('rect.bar').filter(function(){return d3.select(this).attr('fill')==d.color;}).classed('highlight',true);_chart.select('.chart-body').selectAll('rect.bar').filter(function(){return d3.select(this).attr('fill')!=d.color;}).classed('fadeout',true);};_chart.legendReset=function(d){_chart.selectAll('.chart-body').selectAll('rect.bar').filter(function(){return d3.select(this).attr('fill')==d.color;}).classed('highlight',false);_chart.selectAll('.chart-body').selectAll('rect.bar').filter(function(){return d3.select(this).attr('fill')!=d.color;}).classed('fadeout',false);};dc.override(_chart,"xAxisMax",function(){var max=this._xAxisMax();if('resolution'in _chart.xUnits()){var res=_chart.xUnits().resolution;max+=res;}return max;});return _chart.anchor(parent,chartGroup);};dc.lineChart=function(parent,chartGroup){var DEFAULT_DOT_RADIUS=5;var TOOLTIP_G_CLASS="dc-tooltip";var DOT_CIRCLE_CLASS="dot";var Y_AXIS_REF_LINE_CLASS="yRef";var X_AXIS_REF_LINE_CLASS="xRef";var DEFAULT_DOT_OPACITY=1e-6;var _chart=dc.stackableChart(dc.coordinateGridChart({}));var _renderArea=false;var _dotRadius=DEFAULT_DOT_RADIUS;var _dataPointRadius=null;var _dataPointFillOpacity=DEFAULT_DOT_OPACITY;var _dataPointStrokeOpacity=DEFAULT_DOT_OPACITY;var _interpolate='linear';var _tension=0.7;var _defined;var _dashStyle;_chart.transitionDuration(500);_chart.plotData=function(){var chartBody=_chart.chartBodyG();var layersList=chartBody.selectAll("g.stack-list");if(layersList.empty())layersList=chartBody.append("g").attr("class","stack-list");var layers=layersList.selectAll("g.stack").data(_chart.stackLayers());var layersEnter=layers.enter().append("g").attr("class",function(d,i){return"stack "+"_"+i;});drawLine(layersEnter,layers);drawArea(layersEnter,layers);drawDots(chartBody,layers);_chart.stackLayers(null);};_chart.interpolate=function(_){if(!arguments.length)return _interpolate;_interpolate=_;return _chart;};_chart.tension=function(_){if(!arguments.length)return _tension;_tension=_;return _chart;};_chart.defined=function(_){if(!arguments.length)return _defined;_defined=_;return _chart;};_chart.dashStyle=function(_){if(!arguments.length)return _dashStyle;_dashStyle=_;return _chart;};_chart.renderArea=function(_){if(!arguments.length)return _renderArea;_renderArea=_;return _chart;};function drawLine(layersEnter,layers){var line=d3.svg.line().x(function(d){return _chart.x()(d.x);}).y(function(d){return _chart.y()(d.y+d.y0);}).interpolate(_interpolate).tension(_tension);if(_defined)line.defined(_defined);var path=layersEnter.append("path").attr("class","line").attr("stroke",_chart.getColor).attr("fill",_chart.getColor);if(_dashStyle)path.attr("stroke-dasharray",_dashStyle);dc.transition(layers.select("path.line"),_chart.transitionDuration()).attr("d",function(d){return safeD(line(d.points));});}function drawArea(layersEnter,layers){if(_renderArea){var area=d3.svg.area().x(function(d){return _chart.x()(d.x);}).y(function(d){return _chart.y()(d.y+d.y0);}).y0(function(d){return _chart.y()(d.y0);}).interpolate(_interpolate).tension(_tension);if(_defined)area.defined(_defined);layersEnter.append("path").attr("class","area").attr("fill",_chart.getColor).attr("d",function(d){return safeD(area(d.points));});dc.transition(layers.select("path.area"),_chart.transitionDuration()).attr("d",function(d){return safeD(area(d.points));});}}function safeD(d){return(!d||d.indexOf("NaN")>=0)?"M0,0":d;}function drawDots(chartBody,layers){if(!_chart.brushOn()){var tooltipListClass=TOOLTIP_G_CLASS+"-list";var tooltips=chartBody.select("g."+tooltipListClass);if(tooltips.empty())tooltips=chartBody.append("g").attr("class",tooltipListClass);layers.each(function(d,layerIndex){var layer=d3.select(this);var points=layer.datum().points;if(_defined)points=points.filter(_defined);var g=tooltips.select("g."+TOOLTIP_G_CLASS+"._"+layerIndex);if(g.empty())g=tooltips.append("g").attr("class",TOOLTIP_G_CLASS+" _"+layerIndex);createRefLines(g);var dots=g.selectAll("circle."+DOT_CIRCLE_CLASS).data(points);dots.enter().append("circle").attr("class",DOT_CIRCLE_CLASS).attr("r",_dataPointRadius||_dotRadius).attr("fill",_chart.getColor).style("fill-opacity",_dataPointFillOpacity).style("stroke-opacity",_dataPointStrokeOpacity).on("mousemove",function(d){var dot=d3.select(this);showDot(dot);showRefLines(dot,g);}).on("mouseout",function(d){var dot=d3.select(this);hideDot(dot);hideRefLines(g);}).append("title").text(dc.pluck('data',_chart.getTitleByIndex(layerIndex)));dots.attr("cx",function(d){return dc.utils.safeNumber(_chart.x()(d.x));}).attr("cy",function(d){return dc.utils.safeNumber(_chart.y()(d.y+d.y0));}).select("title").text(dc.pluck('data',_chart.getTitleByIndex(layerIndex)));dots.exit().remove();});}}function createRefLines(g){var yRefLine=g.select("path."+Y_AXIS_REF_LINE_CLASS).empty()?g.append("path").attr("class",Y_AXIS_REF_LINE_CLASS):g.select("path."+Y_AXIS_REF_LINE_CLASS);yRefLine.style("display","none").attr("stroke-dasharray","5,5");var xRefLine=g.select("path."+X_AXIS_REF_LINE_CLASS).empty()?g.append("path").attr("class",X_AXIS_REF_LINE_CLASS):g.select("path."+X_AXIS_REF_LINE_CLASS);xRefLine.style("display","none").attr("stroke-dasharray","5,5");}function showDot(dot){dot.style("fill-opacity",0.8);dot.style("stroke-opacity",0.8);dot.attr("r",_dotRadius);return dot;}function showRefLines(dot,g){var x=dot.attr("cx");var y=dot.attr("cy");g.select("path."+Y_AXIS_REF_LINE_CLASS).style("display","").attr("d","M0 "+y+"L"+(x)+" "+(y));g.select("path."+X_AXIS_REF_LINE_CLASS).style("display","").attr("d","M"+x+" "+_chart.yAxisHeight()+"L"+x+" "+y);}function hideDot(dot){dot.style("fill-opacity",_dataPointFillOpacity).style("stroke-opacity",_dataPointStrokeOpacity).attr("r",_dataPointRadius);}function hideRefLines(g){g.select("path."+Y_AXIS_REF_LINE_CLASS).style("display","none");g.select("path."+X_AXIS_REF_LINE_CLASS).style("display","none");}_chart.dotRadius=function(_){if(!arguments.length)return _dotRadius;_dotRadius=_;return _chart;};_chart.renderDataPoints=function(options){if(!arguments.length){return{fillOpacity:_dataPointFillOpacity,strokeOpacity:_dataPointStrokeOpacity,radius:_dataPointRadius};}else if(!options){_dataPointFillOpacity=DEFAULT_DOT_OPACITY;_dataPointStrokeOpacity=DEFAULT_DOT_OPACITY;_dataPointRadius=null;}else{_dataPointFillOpacity=options.fillOpacity||0.8;_dataPointStrokeOpacity=options.strokeOpacity||0.8;_dataPointRadius=options.radius||2;}return _chart;};_chart.legendHighlight=function(d){_chart.selectAll('.chart-body').selectAll('path').filter(function(){return d3.select(this).attr('fill')==d.color;}).classed('highlight',true);_chart.selectAll('.chart-body').selectAll('path').filter(function(){return d3.select(this).attr('fill')!=d.color;}).classed('fadeout',true);};_chart.legendReset=function(d){_chart.selectAll('.chart-body').selectAll('path').filter(function(){return d3.select(this).attr('fill')==d.color;}).classed('highlight',false);_chart.selectAll('.chart-body').selectAll('path').filter(function(){return d3.select(this).attr('fill')!=d.color;}).classed('fadeout',false);};return _chart.anchor(parent,chartGroup);};dc.dataCount=function(parent,chartGroup){var _formatNumber=d3.format(",d");var _chart=dc.baseChart({});_chart.doRender=function(){_chart.selectAll(".total-count").text(_formatNumber(_chart.dimension().size()));_chart.selectAll(".filter-count").text(_formatNumber(_chart.group().value()));return _chart;};_chart.doRedraw=function(){return _chart.doRender();};return _chart.anchor(parent,chartGroup);};dc.dataTable=function(parent,chartGroup){var LABEL_CSS_CLASS="dc-table-label";var ROW_CSS_CLASS="dc-table-row";var COLUMN_CSS_CLASS="dc-table-column";var GROUP_CSS_CLASS="dc-table-group";var _chart=dc.baseChart({});var _size=25;var _columns=[];var _sortBy=function(d){return d;};var _order=d3.ascending;var _sort;_chart.doRender=function(){_chart.selectAll("tbody").remove();renderRows(renderGroups());return _chart;};function renderGroups(){var groups=_chart.root().selectAll("tbody").data(nestEntries(),function(d){return _chart.keyAccessor()(d);});var rowGroup=groups.enter().append("tbody");rowGroup.append("tr").attr("class",GROUP_CSS_CLASS).append("td").attr("class",LABEL_CSS_CLASS).attr("colspan",_columns.length).html(function(d){return _chart.keyAccessor()(d);});groups.exit().remove();return rowGroup;}function nestEntries(){if(!_sort)_sort=crossfilter.quicksort.by(_sortBy);var entries=_chart.dimension().top(_size);return d3.nest().key(_chart.group()).sortKeys(_order).sortValues(_order).entries(_sort(entries,0,entries.length));}function renderRows(groups){var rows=groups.order().selectAll("tr."+ROW_CSS_CLASS).data(function(d){return d.values;});var rowEnter=rows.enter().append("tr").attr("class",ROW_CSS_CLASS);_columns.forEach(function(f,i){rowEnter.append("td").attr("class",COLUMN_CSS_CLASS+" _"+i).html(f);});rows.exit().remove();return rows;}_chart.doRedraw=function(){return _chart.doRender();};_chart.size=function(s){if(!arguments.length)return _size;_size=s;return _chart;};_chart.columns=function(_){if(!arguments.length)return _columns;_columns=_;return _chart;};_chart.sortBy=function(_){if(!arguments.length)return _sortBy;_sortBy=_;return _chart;};_chart.order=function(_){if(!arguments.length)return _order;_order=_;return _chart;};return _chart.anchor(parent,chartGroup);};dc.bubbleChart=function(parent,chartGroup){var _chart=dc.abstractBubbleChart(dc.coordinateGridChart({}));var _elasticRadius=false;_chart.transitionDuration(750);var bubbleLocator=function(d){return"translate("+(bubbleX(d))+","+(bubbleY(d))+")";};_chart.elasticRadius=function(_){if(!arguments.length)return _elasticRadius;_elasticRadius=_;return _chart;};_chart.plotData=function(){if(_elasticRadius)_chart.r().domain([_chart.rMin(),_chart.rMax()]);_chart.r().range([_chart.MIN_RADIUS,_chart.xAxisLength()*_chart.maxBubbleRelativeSize()]);var bubbleG=_chart.chartBodyG().selectAll("g."+_chart.BUBBLE_NODE_CLASS).data(_chart.data(),_chart.keyAccessor());renderNodes(bubbleG);updateNodes(bubbleG);removeNodes(bubbleG);_chart.fadeDeselectedArea();};function renderNodes(bubbleG){var bubbleGEnter=bubbleG.enter().append("g");bubbleGEnter.attr("class",_chart.BUBBLE_NODE_CLASS).attr("transform",bubbleLocator).append("circle").attr("class",function(d,i){return _chart.BUBBLE_CLASS+" _"+i;}).on("click",_chart.onClick).attr("fill",_chart.getColor).attr("r",0);dc.transition(bubbleG,_chart.transitionDuration()).attr("r",function(d){return _chart.bubbleR(d);}).attr("opacity",function(d){return(_chart.bubbleR(d)>0)?1:0;});_chart.doRenderLabel(bubbleGEnter);_chart.doRenderTitles(bubbleGEnter);}function updateNodes(bubbleG){dc.transition(bubbleG,_chart.transitionDuration()).attr("transform",bubbleLocator).selectAll("circle."+_chart.BUBBLE_CLASS).attr("fill",_chart.getColor).attr("r",function(d){return _chart.bubbleR(d);}).attr("opacity",function(d){return(_chart.bubbleR(d)>0)?1:0;});_chart.doUpdateLabels(bubbleG);_chart.doUpdateTitles(bubbleG);}function removeNodes(bubbleG){bubbleG.exit().remove();}function bubbleX(d){var x=_chart.x()(_chart.keyAccessor()(d));if(isNaN(x))x=0;return x;}function bubbleY(d){var y=_chart.y()(_chart.valueAccessor()(d));if(isNaN(y))y=0;return y;}_chart.renderBrush=function(g){};_chart.redrawBrush=function(g){_chart.fadeDeselectedArea();};return _chart.anchor(parent,chartGroup);};dc.compositeChart=function(parent,chartGroup){var SUB_CHART_CLASS="sub";var _chart=dc.coordinateGridChart({});var _children=[];var _shareColors=false,_shareTitle=true;_chart._mandatoryAttributes([]);_chart.transitionDuration(500);dc.override(_chart,"_generateG",function(){var g=this.__generateG();for(var i=0;i<_children.length;++i){var child=_children[i];generateChildG(child,i);if(!child.dimension())child.dimension(_chart.dimension());if(!child.group())child.group(_chart.group());child.chartGroup(_chart.chartGroup());child.svg(_chart.svg());child.xUnits(_chart.xUnits());child.transitionDuration(_chart.transitionDuration());child.brushOn(_chart.brushOn());}return g;});function generateChildG(child,i){child._generateG(_chart.g());child.g().attr("class",SUB_CHART_CLASS+" _"+i);}_chart.plotData=function(){for(var i=0;i<_children.length;++i){var child=_children[i];if(!child.g()){generateChildG(child,i);}if(_shareColors)child.colors(_chart.colors());child.x(_chart.x());child.y(_chart.y());child.xAxis(_chart.xAxis());child.yAxis(_chart.yAxis());child.plotData();child.activateRenderlets();}};_chart.fadeDeselectedArea=function(){for(var i=0;i<_children.length;++i){var child=_children[i];child.brush(_chart.brush());child.fadeDeselectedArea();}};_chart.compose=function(charts){_children=charts;_children.forEach(function(child,i){child.height(_chart.height());child.width(_chart.width());child.margins(_chart.margins());if(_shareTitle){child.title(_chart.title());}if(_shareColors&&child.colorAccessor()===child._layerColorAccessor)child.colorCalculator(function(){return child.colors()(i);});});return _chart;};_chart.children=function(){return _children;};_chart.shareColors=function(_){if(!arguments.length)return _shareColors;_shareColors=_;return _chart;};_chart.shareTitle=function(_){if(!arguments.length)return _shareTitle;_shareTitle=_;return _chart;};function getAllYAxisMinFromChildCharts(){var allMins=[];for(var i=0;i<_children.length;++i){allMins.push(_children[i].yAxisMin());}return allMins;}_chart.yAxisMin=function(){return d3.min(getAllYAxisMinFromChildCharts());};function getAllYAxisMaxFromChildCharts(){var allMaxes=[];for(var i=0;i<_children.length;++i){allMaxes.push(_children[i].yAxisMax());}return allMaxes;}_chart.yAxisMax=function(){return dc.utils.add(d3.max(getAllYAxisMaxFromChildCharts()),_chart.yAxisPadding());};function getAllXAxisMinFromChildCharts(){var allMins=[];for(var i=0;i<_children.length;++i){allMins.push(_children[i].xAxisMin());}return allMins;}_chart.xAxisMin=function(){return dc.utils.subtract(d3.min(getAllXAxisMinFromChildCharts()),_chart.xAxisPadding());};function getAllXAxisMaxFromChildCharts(){var allMaxes=[];for(var i=0;i<_children.length;++i){allMaxes.push(_children[i].xAxisMax());}return allMaxes;}_chart.xAxisMax=function(){return dc.utils.add(d3.max(getAllXAxisMaxFromChildCharts()),_chart.xAxisPadding());};_chart.legendables=function(){var items=[];_children.forEach(function(child,i){if(_shareColors)child.colors(_chart.colors());var childLegendables=child.legendables();if(childLegendables.length)items.push.apply(items,childLegendables);else
items.push(dc.utils.createLegendable(child,child.group(),child.valueAccessor(),child.colorCalculator()(i)));});return items;};_chart.legendHighlight=function(d){for(var j=0;j<_children.length;++j){var child=_children[j];child.legendHighlight(d);}};_chart.legendReset=function(d){for(var j=0;j<_children.length;++j){var child=_children[j];child.legendReset(d);}};return _chart.anchor(parent,chartGroup);};dc.seriesChart=function(parent,chartGroup){var _chart=dc.compositeChart(parent,chartGroup);var _charts={};var _chartFunction=dc.lineChart;var _seriesAccessor;var _seriesSort=d3.ascending;var _valueSort=keySort;_chart._mandatoryAttributes().push('seriesAccessor','chart');_chart.shareColors(true);function keySort(a,b){return d3.ascending(_chart.keyAccessor()(a),_chart.keyAccessor()(b));}_chart._preprocessData=function(){var keep=[];var children_changed;var nester=d3.nest().key(_seriesAccessor);if(_seriesSort)nester.sortKeys(_seriesSort);if(_valueSort)nester.sortValues(_valueSort);var nesting=nester.entries(_chart.data());var children=nesting.map(function(sub,i){var subChart=_charts[sub.key]||_chartFunction.call(_chart,_chart,chartGroup,sub.key,i);if(!_charts[sub.key])children_changed=true;_charts[sub.key]=subChart;keep.push(sub.key);return subChart.dimension(_chart.dimension()).group({all:d3.functor(sub.values)},sub.key).keyAccessor(_chart.keyAccessor()).valueAccessor(_chart.valueAccessor()).colorCalculator(function(){return subChart.colors()(sub.key);});});Object.keys(_charts).filter(function(c){return keep.indexOf(c)===-1;}).forEach(function(c){clearChart(c);children_changed=true;});_chart._compose(children);if(children_changed&&_chart.legend())_chart.legend().render();};function clearChart(c){if(_charts[c].g())_charts[c].g().remove();delete _charts[c];}function resetChildren(){Object.keys(_charts).map(clearChart);_charts={};}_chart.chart=function(_){if(!arguments.length)return _chartFunction;_chartFunction=_;resetChildren();return _chart;};_chart.seriesAccessor=function(_){if(!arguments.length)return _seriesAccessor;_seriesAccessor=_;resetChildren();return _chart;};_chart.seriesSort=function(_){if(!arguments.length)return _seriesSort;_seriesSort=_;resetChildren();return _chart;};_chart.valueSort=function(_){if(!arguments.length)return _valueSort;_valueSort=_;resetChildren();return _chart;};_chart._compose=_chart.compose;delete _chart.compose;return _chart;};dc.geoChoroplethChart=function(parent,chartGroup){var _chart=dc.colorChart(dc.baseChart({}));_chart.colorAccessor(function(d,i){return d||0;});var _geoPath=d3.geo.path();var _projectionFlag;var _geoJsons=[];_chart.doRender=function(){_chart.resetSvg();for(var layerIndex=0;layerIndex<_geoJsons.length;++layerIndex){var states=_chart.svg().append("g").attr("class","layer"+layerIndex);var regionG=states.selectAll("g."+geoJson(layerIndex).name).data(geoJson(layerIndex).data).enter().append("g").attr("class",geoJson(layerIndex).name);regionG.append("path").attr("fill","white").attr("d",_geoPath);regionG.append("title");plotData(layerIndex);}_projectionFlag=false;};function plotData(layerIndex){var data=generateLayeredData();if(isDataLayer(layerIndex)){var regionG=renderRegionG(layerIndex);renderPaths(regionG,layerIndex,data);renderTitle(regionG,layerIndex,data);}}function generateLayeredData(){var data={};var groupAll=_chart.data();for(var i=0;i<groupAll.length;++i){data[_chart.keyAccessor()(groupAll[i])]=_chart.valueAccessor()(groupAll[i]);}return data;}function isDataLayer(layerIndex){return geoJson(layerIndex).keyAccessor;}function renderRegionG(layerIndex){var regionG=_chart.svg().selectAll(layerSelector(layerIndex)).classed("selected",function(d){return isSelected(layerIndex,d);}).classed("deselected",function(d){return isDeselected(layerIndex,d);}).attr("class",function(d){var layerNameClass=geoJson(layerIndex).name;var regionClass=dc.utils.nameToId(geoJson(layerIndex).keyAccessor(d));var baseClasses=layerNameClass+" "+regionClass;if(isSelected(layerIndex,d))baseClasses+=" selected";if(isDeselected(layerIndex,d))baseClasses+=" deselected";return baseClasses;});return regionG;}function layerSelector(layerIndex){return"g.layer"+layerIndex+" g."+geoJson(layerIndex).name;}function isSelected(layerIndex,d){return _chart.hasFilter()&&_chart.hasFilter(getKey(layerIndex,d));}function isDeselected(layerIndex,d){return _chart.hasFilter()&&!_chart.hasFilter(getKey(layerIndex,d));}function getKey(layerIndex,d){return geoJson(layerIndex).keyAccessor(d);}function geoJson(index){return _geoJsons[index];}function renderPaths(regionG,layerIndex,data){var paths=regionG.select("path").attr("fill",function(d){var currentFill=d3.select(this).attr("fill");if(currentFill)return currentFill;return"none";}).on("click",function(d){return _chart.onClick(d,layerIndex);});dc.transition(paths,_chart.transitionDuration()).attr("fill",function(d,i){return _chart.getColor(data[geoJson(layerIndex).keyAccessor(d)],i);});}_chart.onClick=function(d,layerIndex){var selectedRegion=geoJson(layerIndex).keyAccessor(d);dc.events.trigger(function(){_chart.filter(selectedRegion);dc.redrawAll(_chart.chartGroup());});};function renderTitle(regionG,layerIndex,data){if(_chart.renderTitle()){regionG.selectAll("title").text(function(d){var key=getKey(layerIndex,d);var value=data[key];return _chart.title()({key:key,value:value});});}}_chart.doRedraw=function(){for(var layerIndex=0;layerIndex<_geoJsons.length;++layerIndex){plotData(layerIndex);if(_projectionFlag){_chart.svg().selectAll("g."+geoJson(layerIndex).name+" path").attr("d",_geoPath);}}_projectionFlag=false;};_chart.overlayGeoJson=function(json,name,keyAccessor){for(var i=0;i<_geoJsons.length;++i){if(_geoJsons[i].name==name){_geoJsons[i].data=json;_geoJsons[i].keyAccessor=keyAccessor;return _chart;}}_geoJsons.push({name:name,data:json,keyAccessor:keyAccessor});return _chart;};_chart.projection=function(projection){_geoPath.projection(projection);_projectionFlag=true;return _chart;};_chart.geoJsons=function(){return _geoJsons;};_chart.removeGeoJson=function(name){var geoJsons=[];for(var i=0;i<_geoJsons.length;++i){var layer=_geoJsons[i];if(layer.name!=name){geoJsons.push(layer);}}_geoJsons=geoJsons;return _chart;};return _chart.anchor(parent,chartGroup);};dc.bubbleOverlay=function(root,chartGroup){var BUBBLE_OVERLAY_CLASS="bubble-overlay";var BUBBLE_NODE_CLASS="node";var BUBBLE_CLASS="bubble";var _chart=dc.abstractBubbleChart(dc.baseChart({}));var _g;var _points=[];_chart.transitionDuration(750);_chart.radiusValueAccessor(function(d){return d.value;});_chart.point=function(name,x,y){_points.push({name:name,x:x,y:y});return _chart;};_chart.doRender=function(){_g=initOverlayG();_chart.r().range([_chart.MIN_RADIUS,_chart.width()*_chart.maxBubbleRelativeSize()]);initializeBubbles();_chart.fadeDeselectedArea();return _chart;};function initOverlayG(){_g=_chart.select("g."+BUBBLE_OVERLAY_CLASS);if(_g.empty())_g=_chart.svg().append("g").attr("class",BUBBLE_OVERLAY_CLASS);return _g;}function initializeBubbles(){var data=mapData();_points.forEach(function(point){var nodeG=getNodeG(point,data);var circle=nodeG.select("circle."+BUBBLE_CLASS);if(circle.empty())circle=nodeG.append("circle").attr("class",BUBBLE_CLASS).attr("r",0).attr("fill",_chart.getColor).on("click",_chart.onClick);dc.transition(circle,_chart.transitionDuration()).attr("r",function(d){return _chart.bubbleR(d);});_chart.doRenderLabel(nodeG);_chart.doRenderTitles(nodeG);});}function mapData(){var data={};_chart.data().forEach(function(datum){data[_chart.keyAccessor()(datum)]=datum;});return data;}function getNodeG(point,data){var bubbleNodeClass=BUBBLE_NODE_CLASS+" "+dc.utils.nameToId(point.name);var nodeG=_g.select("g."+dc.utils.nameToId(point.name));if(nodeG.empty()){nodeG=_g.append("g").attr("class",bubbleNodeClass).attr("transform","translate("+point.x+","+point.y+")");}nodeG.datum(data[point.name]);return nodeG;}_chart.doRedraw=function(){updateBubbles();_chart.fadeDeselectedArea();return _chart;};function updateBubbles(){var data=mapData();_points.forEach(function(point){var nodeG=getNodeG(point,data);var circle=nodeG.select("circle."+BUBBLE_CLASS);dc.transition(circle,_chart.transitionDuration()).attr("r",function(d){return _chart.bubbleR(d);}).attr("fill",_chart.getColor);_chart.doUpdateLabels(nodeG);_chart.doUpdateTitles(nodeG);});}_chart.debug=function(flag){if(flag){var debugG=_chart.select("g."+dc.constants.DEBUG_GROUP_CLASS);if(debugG.empty())debugG=_chart.svg().append("g").attr("class",dc.constants.DEBUG_GROUP_CLASS);var debugText=debugG.append("text").attr("x",10).attr("y",20);debugG.append("rect").attr("width",_chart.width()).attr("height",_chart.height()).on("mousemove",function(){var position=d3.mouse(debugG.node());var msg=position[0]+", "+position[1];debugText.text(msg);});}else{_chart.selectAll(".debug").remove();}return _chart;};_chart.anchor(root,chartGroup);return _chart;};dc.rowChart=function(parent,chartGroup){var _g;var _labelOffsetX=10;var _labelOffsetY=15;var _gap=5;var _rowCssClass="row";var _chart=dc.capped(dc.marginable(dc.colorChart(dc.baseChart({}))));var _x;var _elasticX;var _xAxis=d3.svg.axis().orient("bottom");var _rowData;_chart.rowsCap=_chart.cap;function calculateAxisScale(){if(!_x||_elasticX){var extent=d3.extent(_rowData,_chart.cappedValueAccessor);if(extent[0]>0)extent[0]=0;_x=d3.scale.linear().domain(extent).range([0,_chart.effectiveWidth()]);}_xAxis.scale(_x);}function drawAxis(){var axisG=_g.select("g.axis");calculateAxisScale();if(axisG.empty())axisG=_g.append("g").attr("class","axis").attr("transform","translate(0, "+_chart.effectiveHeight()+")");dc.transition(axisG,_chart.transitionDuration()).call(_xAxis);}_chart.doRender=function(){_chart.resetSvg();_g=_chart.svg().append("g").attr("transform","translate("+_chart.margins().left+","+_chart.margins().top+")");drawChart();return _chart;};_chart.title(function(d){return _chart.cappedKeyAccessor(d)+": "+_chart.cappedValueAccessor(d);});_chart.label(_chart.cappedKeyAccessor);_chart.x=function(x){if(!arguments.length)return _x;_x=x;return _chart;};function drawGridLines(){_g.selectAll("g.tick").select("line.grid-line").remove();_g.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(){return-_chart.effectiveHeight();});}function drawChart(){_rowData=_chart.data();drawAxis();drawGridLines();var rows=_g.selectAll("g."+_rowCssClass).data(_rowData);createElements(rows);removeElements(rows);updateElements(rows);}function createElements(rows){var rowEnter=rows.enter().append("g").attr("class",function(d,i){return _rowCssClass+" _"+i;});rowEnter.append("rect").attr("width",0);createLabels(rowEnter);updateLabels(rows);}function removeElements(rows){rows.exit().remove();}function updateElements(rows){var n=_rowData.length;var height=(_chart.effectiveHeight()-(n+1)*_gap)/n;var rect=rows.attr("transform",function(d,i){return"translate(0,"+((i+1)*_gap+i*height)+")";}).select("rect").attr("height",height).attr("fill",_chart.getColor).on("click",onClick).classed("deselected",function(d){return(_chart.hasFilter())?!isSelectedRow(d):false;}).classed("selected",function(d){return(_chart.hasFilter())?isSelectedRow(d):false;});dc.transition(rect,_chart.transitionDuration()).attr("width",function(d){var start=_x(0)==-Infinity?_x(1):_x(0);return Math.abs(start-_x(_chart.valueAccessor()(d)));}).attr("transform",translateX);createTitles(rows);updateLabels(rows);}function createTitles(rows){if(_chart.renderTitle()){rows.selectAll("title").remove();rows.append("title").text(_chart.title());}}function createLabels(rowEnter){if(_chart.renderLabel()){rowEnter.append("text").on("click",onClick);}}function updateLabels(rows){if(_chart.renderLabel()){var lab=rows.select("text").attr("x",_labelOffsetX).attr("y",_labelOffsetY).on("click",onClick).attr("class",function(d,i){return _rowCssClass+" _"+i;}).text(function(d){return _chart.label()(d);});dc.transition(lab,_chart.transitionDuration()).attr("transform",translateX);}}function onClick(d){_chart.onClick(d);}function translateX(d){var x=_x(_chart.cappedValueAccessor(d)),x0=_x(0),s=x>x0?x0:x;return"translate("+s+",0)";}_chart.doRedraw=function(){drawChart();return _chart;};_chart.xAxis=function(){return _xAxis;};_chart.gap=function(g){if(!arguments.length)return _gap;_gap=g;return _chart;};_chart.elasticX=function(_){if(!arguments.length)return _elasticX;_elasticX=_;return _chart;};_chart.labelOffsetX=function(o){if(!arguments.length)return _labelOffsetX;_labelOffsetX=o;return _chart;};_chart.labelOffsetY=function(o){if(!arguments.length)return _labelOffsetY;_labelOffsetY=o;return _chart;};function isSelectedRow(d){return _chart.hasFilter(_chart.cappedKeyAccessor(d));}return _chart.anchor(parent,chartGroup);};dc.legend=function(){var LABEL_GAP=2;var _legend={},_parent,_x=0,_y=0,_itemHeight=12,_gap=5;var _g;_legend.parent=function(p){if(!arguments.length)return _parent;_parent=p;return _legend;};_legend.render=function(){_parent.svg().select("g.dc-legend").remove();_g=_parent.svg().append("g").attr("class","dc-legend").attr("transform","translate("+_x+","+_y+")");var itemEnter=_g.selectAll('g.dc-legend-item').data(_parent.legendables()).enter().append("g").attr("class","dc-legend-item").attr("transform",function(d,i){return"translate(0,"+i*legendItemHeight()+")";}).on("mouseover",function(d){_parent.legendHighlight(d);}).on("mouseout",function(d){_parent.legendReset(d);});itemEnter.append("rect").attr("width",_itemHeight).attr("height",_itemHeight).attr("fill",function(d){return d.color;});itemEnter.append("text").text(function(d){return d.name;}).attr("x",_itemHeight+LABEL_GAP).attr("y",function(){return _itemHeight/2+(this.clientHeight?this.clientHeight:13)/2-2;});};function legendItemHeight(){return _gap+_itemHeight;}_legend.x=function(x){if(!arguments.length)return _x;_x=x;return _legend;};_legend.y=function(y){if(!arguments.length)return _y;_y=y;return _legend;};_legend.gap=function(gap){if(!arguments.length)return _gap;_gap=gap;return _legend;};_legend.itemHeight=function(h){if(!arguments.length)return _itemHeight;_itemHeight=h;return _legend;};return _legend;};dc.capped=function(_chart){var _cap=Infinity;var _othersLabel="Others";var _othersGrouper=function(topRows){var topRowsSum=d3.sum(topRows,_chart.valueAccessor()),allRows=_chart.group().all(),allRowsSum=d3.sum(allRows,_chart.valueAccessor()),topKeys=topRows.map(_chart.keyAccessor()),allKeys=allRows.map(_chart.keyAccessor()),topSet=d3.set(topKeys),others=allKeys.filter(function(d){return!topSet.has(d);});if(allRowsSum>topRowsSum)return topRows.concat([{"others":others,"key":_othersLabel,"value":allRowsSum-topRowsSum}]);return topRows;};_chart.cappedKeyAccessor=function(d,i){if(d.others)return d.key;return _chart.keyAccessor()(d,i);};_chart.cappedValueAccessor=function(d,i){if(d.others)return d.value;return _chart.valueAccessor()(d,i);};_chart.data(function(group){if(_cap==Infinity){return _chart.computeOrderedGroups(group.all());}else{var topRows=group.top(_cap);topRows=_chart.computeOrderedGroups(topRows);if(_othersGrouper)return _othersGrouper(topRows);return topRows;}});_chart.cap=function(_){if(!arguments.length)return _cap;_cap=_;return _chart;};_chart.othersLabel=function(_){if(!arguments.length)return _othersLabel;_othersLabel=_;return _chart;};_chart.othersGrouper=function(_){if(!arguments.length)return _othersGrouper;_othersGrouper=_;return _chart;};dc.override(_chart,"onClick",function(d){if(d.others)_chart.filter([d.others]);_chart._onClick(d);});return _chart;};dc.scatterPlot=function(parent,chartGroup){var _chart=dc.coordinateGridChart({});var _locator=function(d){return"translate("+_chart.x()(_chart.keyAccessor()(d))+","+_chart.y()(_chart.valueAccessor()(d))+")";};var _symbolSize=3;_chart.transitionDuration(0);_chart.plotData=function(){var symbols=_chart.chartBodyG().selectAll("circle.symbol").data(_chart.data());symbols.enter().append("circle").attr("class","symbol").attr("fill",_chart.getColor(0)).attr("transform",_locator);dc.transition(symbols,_chart.transitionDuration()).attr("transform",_locator).attr("r",_symbolSize);dc.transition(symbols.filter(function(d){return _chart.valueAccessor()(d)===0;}),_chart.transitionDuration()).attr("r",0).remove();dc.transition(symbols.exit(),_chart.transitionDuration()).attr("r",0).remove();};_chart.symbolSize=function(s){if(!arguments.length)return _symbolSize;_symbolSize=s;return _chart;};return _chart.anchor(parent,chartGroup);};dc.numberDisplay=function(parent,chartGroup){var SPAN_CLASS='number-display';var _formatNumber=d3.format(".2s");var _chart=dc.baseChart({});_chart._mandatoryAttributes(['group']);_chart.value=function(){return _chart.data();};_chart.data(function(group){var valObj=group.value?group.value():group.top(1)[0];return _chart.valueAccessor()(valObj);});_chart.transitionDuration(250);_chart.doRender=function(){var newValue=_chart.value(),span=_chart.selectAll("."+SPAN_CLASS);if(span.empty())span=span.data([0]).enter().append("span").attr("class",SPAN_CLASS);span.transition().duration(_chart.transitionDuration()).ease('quad-out-in').tween("text",function(){var interp=d3.interpolateNumber(this.lastValue||0,newValue);this.lastValue=newValue;return function(t){this.textContent=_chart.formatNumber()(interp(t));};});return _chart;};_chart.doRedraw=function(){return _chart.doRender();};_chart.formatNumber=function(_){if(!arguments.length)return _formatNumber;_formatNumber=_;return _chart;};return _chart.anchor(parent,chartGroup);};dc.heatMap=function(parent,chartGroup){var _chartBody;var _cols;var _rows;var _chart=dc.colorChart(dc.marginable(dc.baseChart({})));_chart._mandatoryAttributes(['group']);_chart.title(_chart.colorAccessor());_chart.boxOnClick=function(){};_chart.xAxisOnClick=function(){};_chart.yAxisOnClick=function(){};function uniq(d,i,a){return!i||a[i-1]!=d;}_chart.rows=function(_){if(arguments.length){_rows=_;return _chart;}if(_rows)return _rows;var rowValues=_chart.data().map(_chart.valueAccessor());rowValues.sort(d3.ascending);return d3.scale.ordinal().domain(rowValues.filter(uniq));};_chart.cols=function(_){if(arguments.length){_cols=_;return _chart;}if(_cols)return _cols;var colValues=_chart.data().map(_chart.keyAccessor());colValues.sort(d3.ascending);return d3.scale.ordinal().domain(colValues.filter(uniq));};_chart.doRender=function(){_chart.resetSvg();_chartBody=_chart.svg().append("g").attr("class","heatmap").attr("transform","translate("+_chart.margins().left+","+_chart.margins().top+")");return _chart.doRedraw();};_chart.doRedraw=function(){var rows=_chart.rows(),cols=_chart.cols(),rowCount=rows.domain().length,colCount=cols.domain().length,boxWidth=Math.floor(_chart.effectiveWidth()/colCount),boxHeight=Math.floor(_chart.effectiveHeight()/rowCount);cols.rangeRoundBands([0,_chart.effectiveWidth()]);rows.rangeRoundBands([_chart.effectiveHeight(),0]);var boxes=_chartBody.selectAll("g.box-group").data(_chart.data(),function(d,i){return _chart.keyAccessor()(d,i)+'\0'+_chart.valueAccessor()(d,i);});var gEnter=boxes.enter().append("g").attr("class","box-group");gEnter.append("rect").attr("fill","white").on("click",_chart.boxOnClick);gEnter.append("title").text(function(d){return _chart.title()(d);});dc.transition(boxes.select("rect"),_chart.transitionDuration()).attr("class","heat-box").attr("x",function(d,i){return cols(_chart.keyAccessor()(d,i));}).attr("y",function(d,i){return rows(_chart.valueAccessor()(d,i));}).attr("rx",0.15*boxWidth).attr("ry",0.15*boxHeight).attr("fill",_chart.getColor).attr("width",boxWidth).attr("height",boxHeight);boxes.exit().remove();var gCols=_chartBody.selectAll("g.cols");if(gCols.empty())gCols=_chartBody.append("g").attr("class","cols axis");gCols.selectAll('text').data(cols.domain()).enter().append("text").attr("x",function(d){return cols(d)+boxWidth/2;}).style("text-anchor","middle").attr("y",_chart.effectiveHeight()).attr("dy",12).on("click",_chart.xAxisOnClick).text(function(d){return d;});var gRows=_chartBody.selectAll("g.rows");if(gRows.empty())gRows=_chartBody.append("g").attr("class","rows axis");gRows.selectAll('text').data(rows.domain()).enter().append("text").attr("y",function(d){return rows(d)+boxHeight/2;}).attr("dy",6).style("text-anchor","end").attr("x",0).attr("dx",-2).on("click",_chart.yAxisOnClick).text(function(d){return d;});};return _chart.anchor(parent,chartGroup);};(function(){d3.box=function(){var width=1,height=1,duration=0,domain=null,value=Number,whiskers=boxWhiskers,quartiles=boxQuartiles,tickFormat=null;function box(g){g.each(function(d,i){d=d.map(value).sort(d3.ascending);var g=d3.select(this),n=d.length,min=d[0],max=d[n-1];var quartileData=d.quartiles=quartiles(d);var whiskerIndices=whiskers&&whiskers.call(this,d,i),whiskerData=whiskerIndices&&whiskerIndices.map(function(i){return d[i];});var outlierIndices=whiskerIndices?d3.range(0,whiskerIndices[0]).concat(d3.range(whiskerIndices[1]+1,n)):d3.range(n);var x1=d3.scale.linear().domain(domain&&domain.call(this,d,i)||[min,max]).range([height,0]);var x0=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(x1.range());this.__chart__=x1;var center=g.selectAll("line.center").data(whiskerData?[whiskerData]:[]);center.enter().insert("line","rect").attr("class","center").attr("x1",width/2).attr("y1",function(d){return x0(d[0]);}).attr("x2",width/2).attr("y2",function(d){return x0(d[1]);}).style("opacity",1e-6).transition().duration(duration).style("opacity",1).attr("y1",function(d){return x1(d[0]);}).attr("y2",function(d){return x1(d[1]);});center.transition().duration(duration).style("opacity",1).attr("y1",function(d){return x1(d[0]);}).attr("y2",function(d){return x1(d[1]);});center.exit().transition().duration(duration).style("opacity",1e-6).attr("y1",function(d){return x1(d[0]);}).attr("y2",function(d){return x1(d[1]);}).remove();var box=g.selectAll("rect.box").data([quartileData]);box.enter().append("rect").attr("class","box").attr("x",0).attr("y",function(d){return x0(d[2]);}).attr("width",width).attr("height",function(d){return x0(d[0])-x0(d[2]);}).transition().duration(duration).attr("y",function(d){return x1(d[2]);}).attr("height",function(d){return x1(d[0])-x1(d[2]);});box.transition().duration(duration).attr("y",function(d){return x1(d[2]);}).attr("height",function(d){return x1(d[0])-x1(d[2]);});var medianLine=g.selectAll("line.median").data([quartileData[1]]);medianLine.enter().append("line").attr("class","median").attr("x1",0).attr("y1",x0).attr("x2",width).attr("y2",x0).transition().duration(duration).attr("y1",x1).attr("y2",x1);medianLine.transition().duration(duration).attr("y1",x1).attr("y2",x1);var whisker=g.selectAll("line.whisker").data(whiskerData||[]);whisker.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",x0).attr("x2",width).attr("y2",x0).style("opacity",1e-6).transition().duration(duration).attr("y1",x1).attr("y2",x1).style("opacity",1);whisker.transition().duration(duration).attr("y1",x1).attr("y2",x1).style("opacity",1);whisker.exit().transition().duration(duration).attr("y1",x1).attr("y2",x1).style("opacity",1e-6).remove();var outlier=g.selectAll("circle.outlier").data(outlierIndices,Number);outlier.enter().insert("circle","text").attr("class","outlier").attr("r",5).attr("cx",width/2).attr("cy",function(i){return x0(d[i]);}).style("opacity",1e-6).transition().duration(duration).attr("cy",function(i){return x1(d[i]);}).style("opacity",1);outlier.transition().duration(duration).attr("cy",function(i){return x1(d[i]);}).style("opacity",1);outlier.exit().transition().duration(duration).attr("cy",function(i){return x1(d[i]);}).style("opacity",1e-6).remove();var format=tickFormat||x1.tickFormat(8);var boxTick=g.selectAll("text.box").data(quartileData);boxTick.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",function(d,i){return i&1?6:-6;}).attr("x",function(d,i){return i&1?width:0;}).attr("y",x0).attr("text-anchor",function(d,i){return i&1?"start":"end";}).text(format).transition().duration(duration).attr("y",x1);boxTick.transition().duration(duration).text(format).attr("y",x1);var whiskerTick=g.selectAll("text.whisker").data(whiskerData||[]);whiskerTick.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",width).attr("y",x0).text(format).style("opacity",1e-6).transition().duration(duration).attr("y",x1).style("opacity",1);whiskerTick.transition().duration(duration).text(format).attr("y",x1).style("opacity",1);whiskerTick.exit().transition().duration(duration).attr("y",x1).style("opacity",1e-6).remove();});d3.timer.flush();}box.width=function(x){if(!arguments.length)return width;width=x;return box;};box.height=function(x){if(!arguments.length)return height;height=x;return box;};box.tickFormat=function(x){if(!arguments.length)return tickFormat;tickFormat=x;return box;};box.duration=function(x){if(!arguments.length)return duration;duration=x;return box;};box.domain=function(x){if(!arguments.length)return domain;domain=x==null?x:d3.functor(x);return box;};box.value=function(x){if(!arguments.length)return value;value=x;return box;};box.whiskers=function(x){if(!arguments.length)return whiskers;whiskers=x;return box;};box.quartiles=function(x){if(!arguments.length)return quartiles;quartiles=x;return box;};return box;};function boxWhiskers(d){return[0,d.length-1];}function boxQuartiles(d){return[d3.quantile(d,.25),d3.quantile(d,.5),d3.quantile(d,.75)];}})();dc.boxPlot=function(parent,chartGroup){var _chart=dc.coordinateGridChart({});var _whisker_iqr_factor=1.5;var _whiskers_iqr=default_whiskers_iqr;var _whiskers=_whiskers_iqr(_whisker_iqr_factor);var _box=d3.box();var _boxWidth=function(innerChartWidth,xUnits){if(_chart.isOrdinal())return _chart.x().rangeBand();else
return innerChartWidth/(1+_chart.boxPadding())/xUnits;};_chart.yAxisPadding(12);_chart.x(d3.scale.ordinal());_chart.xUnits(dc.units.ordinal);_chart.data(function(group){return group.all().map(function(d){d.map=function(accessor){return accessor.call(d,d);};return d;});});_chart.boxPadding=_chart._rangeBandPadding;_chart.boxPadding(0.8);_chart.outerPadding=_chart._outerRangeBandPadding;_chart.outerPadding(0.5);_chart.boxWidth=function(_){if(!arguments.length)return _boxWidth;_boxWidth=d3.functor(_);return _chart;};_chart.plotData=function(){var _calculatedBoxWidth=_boxWidth(_chart.effectiveWidth(),_chart.xUnitCount());_box.whiskers(_whiskers).width(_calculatedBoxWidth).height(_chart.effectiveHeight()).value(_chart.valueAccessor()).domain(_chart.y().domain());var boxTransform=function(d,i){var xOffset=_chart.x()(_chart.keyAccessor()(d,i));return"translate("+xOffset+",0)";};_chart.chartBodyG().selectAll('g.box').data(_chart.data()).enter().append("g").attr("class","box").attr("transform",boxTransform).call(_box);};_chart.yAxisMin=function(){var min=d3.min(_chart.data(),function(e){return d3.min(_chart.valueAccessor()(e));});return dc.utils.subtract(min,_chart.yAxisPadding());};_chart.yAxisMax=function(){var max=d3.max(_chart.data(),function(e){return d3.max(_chart.valueAccessor()(e));});return dc.utils.add(max,_chart.yAxisPadding());};function default_whiskers_iqr(k){return function(d){var q1=d.quartiles[0],q3=d.quartiles[2],iqr=(q3-q1)*k,i=-1,j=d.length;while(d[++i]<q1-iqr);while(d[--j]>q3+iqr);return[i,j];};}return _chart.anchor(parent,chartGroup);};return dc;})();